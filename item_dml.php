<?php

// Data functions (insert, update, delete, form) for table item

// This script and data application were generated by AppGini 5.73
// Download AppGini for free from https://bigprof.com/appgini/download/

function item_insert(){
	global $Translation;

	// mm: can member insert record?
	$arrPerm=getTablePermissions('item');
	if(!$arrPerm[1]){
		return false;
	}

	$data['titulo'] = makeSafe($_REQUEST['titulo']);
		if($data['titulo'] == empty_lookup_value){ $data['titulo'] = ''; }
	$data['titulo_atribuido'] = makeSafe($_REQUEST['titulo_atribuido']);
		if($data['titulo_atribuido'] == empty_lookup_value){ $data['titulo_atribuido'] = ''; }
	$data['descricao'] = br2nl(makeSafe($_REQUEST['descricao']));
	$data['date'] = intval($_REQUEST['dateYear']) . '-' . intval($_REQUEST['dateMonth']) . '-' . intval($_REQUEST['dateDay']);
	$data['date'] = parseMySQLDate($data['date'], '');
	$data['data_livre'] = makeSafe($_REQUEST['data_livre']);
		if($data['data_livre'] == empty_lookup_value){ $data['data_livre'] = ''; }
	$data['data_atribuida'] = makeSafe($_REQUEST['data_atribuida']);
		if($data['data_atribuida'] == empty_lookup_value){ $data['data_atribuida'] = ''; }
	$data['autoria'] = makeSafe($_REQUEST['autoria']);
		if($data['autoria'] == empty_lookup_value){ $data['autoria'] = ''; }
	$data['quantidade'] = makeSafe($_REQUEST['quantidade']);
		if($data['quantidade'] == empty_lookup_value){ $data['quantidade'] = ''; }
	$data['idioma'] = makeSafe($_REQUEST['idioma']);
		if($data['idioma'] == empty_lookup_value){ $data['idioma'] = ''; }
	$data['local_producao'] = makeSafe($_REQUEST['local_producao']);
		if($data['local_producao'] == empty_lookup_value){ $data['local_producao'] = ''; }
	$data['local_publicacao_veiculo'] = makeSafe($_REQUEST['local_publicacao_veiculo']);
		if($data['local_publicacao_veiculo'] == empty_lookup_value){ $data['local_publicacao_veiculo'] = ''; }
	$data['local_publicacao'] = makeSafe($_REQUEST['local_publicacao']);
		if($data['local_publicacao'] == empty_lookup_value){ $data['local_publicacao'] = ''; }
	$data['tipo_publicacao'] = makeSafe($_REQUEST['tipo_publicacao']);
		if($data['tipo_publicacao'] == empty_lookup_value){ $data['tipo_publicacao'] = ''; }
	$data['identificacao'] = makeSafe($_REQUEST['identificacao']);
		if($data['identificacao'] == empty_lookup_value){ $data['identificacao'] = ''; }
	$data['colecao'] = makeSafe($_REQUEST['colecao']);
		if($data['colecao'] == empty_lookup_value){ $data['colecao'] = ''; }
	$data['colecao_codigo'] = makeSafe($_REQUEST['colecao']);
		if($data['colecao_codigo'] == empty_lookup_value){ $data['colecao_codigo'] = ''; }
	$data['grupo'] = makeSafe($_REQUEST['grupo']);
		if($data['grupo'] == empty_lookup_value){ $data['grupo'] = ''; }
	$data['grupo_codigo'] = makeSafe($_REQUEST['grupo']);
		if($data['grupo_codigo'] == empty_lookup_value){ $data['grupo_codigo'] = ''; }
	$data['serie'] = makeSafe($_REQUEST['serie']);
		if($data['serie'] == empty_lookup_value){ $data['serie'] = ''; }
	$data['serie_codigo'] = makeSafe($_REQUEST['serie']);
		if($data['serie_codigo'] == empty_lookup_value){ $data['serie_codigo'] = ''; }
	$data['subserie'] = makeSafe($_REQUEST['subserie']);
		if($data['subserie'] == empty_lookup_value){ $data['subserie'] = ''; }
	$data['numero_serie'] = makeSafe($_REQUEST['numero_serie']);
		if($data['numero_serie'] == empty_lookup_value){ $data['numero_serie'] = ''; }
	$data['tipologia'] = makeSafe($_REQUEST['tipologia']);
		if($data['tipologia'] == empty_lookup_value){ $data['tipologia'] = ''; }
	$data['genero'] = makeSafe($_REQUEST['genero']);
		if($data['genero'] == empty_lookup_value){ $data['genero'] = ''; }
	if(is_array($_REQUEST['forma'])){
		$MultipleSeparator=', ';
		foreach($_REQUEST['forma'] as $k => $v)
			$data['forma'] .= makeSafe($v) . $MultipleSeparator;
		$data['forma'] = substr($data['forma'], 0, -1 * strlen($MultipleSeparator));
	}else{
		$data['forma']='';
	}
	$data['formato'] = makeSafe($_REQUEST['formato']);
		if($data['formato'] == empty_lookup_value){ $data['formato'] = ''; }
	if(is_array($_REQUEST['escritura'])){
		$MultipleSeparator=', ';
		foreach($_REQUEST['escritura'] as $k => $v)
			$data['escritura'] .= makeSafe($v) . $MultipleSeparator;
		$data['escritura'] = substr($data['escritura'], 0, -1 * strlen($MultipleSeparator));
	}else{
		$data['escritura']='';
	}
	$data['suporte'] = makeSafe($_REQUEST['suporte']);
		if($data['suporte'] == empty_lookup_value){ $data['suporte'] = ''; }
	$data['dimensao'] = makeSafe($_REQUEST['dimensao']);
		if($data['dimensao'] == empty_lookup_value){ $data['dimensao'] = ''; }
	if(is_array($_REQUEST['estado_conservacao'])){
		$MultipleSeparator=', ';
		foreach($_REQUEST['estado_conservacao'] as $k => $v)
			$data['estado_conservacao'] .= makeSafe($v) . $MultipleSeparator;
		$data['estado_conservacao'] = substr($data['estado_conservacao'], 0, -1 * strlen($MultipleSeparator));
	}else{
		$data['estado_conservacao']='';
	}
	$data['observacoes'] = br2nl(makeSafe($_REQUEST['observacoes']));
	$data['documentos_relacionados'] = makeSafe($_REQUEST['documentos_relacionados']);
		if($data['documentos_relacionados'] == empty_lookup_value){ $data['documentos_relacionados'] = ''; }
	$data['numero_caixa'] = makeSafe($_REQUEST['numero_caixa']);
		if($data['numero_caixa'] == empty_lookup_value){ $data['numero_caixa'] = ''; }
	$data['nome_caixa'] = makeSafe($_REQUEST['nome_caixa']);
		if($data['nome_caixa'] == empty_lookup_value){ $data['nome_caixa'] = ''; }
	$data['numero_pasta'] = makeSafe($_REQUEST['numero_pasta']);
		if($data['numero_pasta'] == empty_lookup_value){ $data['numero_pasta'] = ''; }
	$data['nome_pasta'] = makeSafe($_REQUEST['nome_pasta']);
		if($data['nome_pasta'] == empty_lookup_value){ $data['nome_pasta'] = ''; }
	$data['usuario_cadastro'] = parseCode('<%%creatorUsername%%>-<%%creationDateTime%%>', true);
	$data['publicar'] = makeSafe($_REQUEST['publicar']);
		if($data['publicar'] == empty_lookup_value){ $data['publicar'] = ''; }
	$data['upload'] = PrepareUploadedFile('upload', 20480000,'txt|doc|docx|docm|odt|pdf|rtf', false, '');
	if($data['identificacao']== ''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">" . $Translation['error:'] . " 'Identifica&#231;&#227;o:': " . $Translation['field not null'] . '<br><br>';
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	if($data['colecao']== ''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">" . $Translation['error:'] . " 'Cole&#231;&#227;o:': " . $Translation['field not null'] . '<br><br>';
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	if($data['grupo']== ''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">" . $Translation['error:'] . " 'Grupo:': " . $Translation['field not null'] . '<br><br>';
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	if($data['serie']== ''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">" . $Translation['error:'] . " 'S&#233;rie:': " . $Translation['field not null'] . '<br><br>';
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	if($data['tipologia']== ''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">" . $Translation['error:'] . " 'Tipologia / Esp&#233;cie:': " . $Translation['field not null'] . '<br><br>';
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}

	/* for empty upload fields, when saving a copy of an existing record, copy the original upload field */
	if($_REQUEST['SelectedID']){
		$res = sql("select * from item where id='" . makeSafe($_REQUEST['SelectedID']) . "'", $eo);
		if($row = db_fetch_assoc($res)){
			if(!$data['upload']) $data['upload'] = makeSafe($row['upload']);
		}
	}

	// hook: item_before_insert
	if(function_exists('item_before_insert')){
		$args=array();
		if(!item_before_insert($data, getMemberInfo(), $args)){ return false; }
	}

	$o = array('silentErrors' => true);
	sql('insert into `item` set       `titulo`=' . (($data['titulo'] !== '' && $data['titulo'] !== NULL) ? "'{$data['titulo']}'" : 'NULL') . ', `titulo_atribuido`=' . (($data['titulo_atribuido'] !== '' && $data['titulo_atribuido'] !== NULL) ? "'{$data['titulo_atribuido']}'" : 'NULL') . ', `descricao`=' . (($data['descricao'] !== '' && $data['descricao'] !== NULL) ? "'{$data['descricao']}'" : 'NULL') . ', `date`=' . (($data['date'] !== '' && $data['date'] !== NULL) ? "'{$data['date']}'" : 'NULL') . ', `data_livre`=' . (($data['data_livre'] !== '' && $data['data_livre'] !== NULL) ? "'{$data['data_livre']}'" : 'NULL') . ', `data_atribuida`=' . (($data['data_atribuida'] !== '' && $data['data_atribuida'] !== NULL) ? "'{$data['data_atribuida']}'" : 'NULL') . ', `autoria`=' . (($data['autoria'] !== '' && $data['autoria'] !== NULL) ? "'{$data['autoria']}'" : 'NULL') . ', `quantidade`=' . (($data['quantidade'] !== '' && $data['quantidade'] !== NULL) ? "'{$data['quantidade']}'" : 'NULL') . ', `idioma`=' . (($data['idioma'] !== '' && $data['idioma'] !== NULL) ? "'{$data['idioma']}'" : 'NULL') . ', `local_producao`=' . (($data['local_producao'] !== '' && $data['local_producao'] !== NULL) ? "'{$data['local_producao']}'" : 'NULL') . ', `local_publicacao_veiculo`=' . (($data['local_publicacao_veiculo'] !== '' && $data['local_publicacao_veiculo'] !== NULL) ? "'{$data['local_publicacao_veiculo']}'" : 'NULL') . ', `local_publicacao`=' . (($data['local_publicacao'] !== '' && $data['local_publicacao'] !== NULL) ? "'{$data['local_publicacao']}'" : 'NULL') . ', `tipo_publicacao`=' . (($data['tipo_publicacao'] !== '' && $data['tipo_publicacao'] !== NULL) ? "'{$data['tipo_publicacao']}'" : 'NULL') . ', `identificacao`=' . (($data['identificacao'] !== '' && $data['identificacao'] !== NULL) ? "'{$data['identificacao']}'" : 'NULL') . ', `colecao`=' . (($data['colecao'] !== '' && $data['colecao'] !== NULL) ? "'{$data['colecao']}'" : 'NULL') . ', `colecao_codigo`=' . (($data['colecao_codigo'] !== '' && $data['colecao_codigo'] !== NULL) ? "'{$data['colecao_codigo']}'" : 'NULL') . ', `grupo`=' . (($data['grupo'] !== '' && $data['grupo'] !== NULL) ? "'{$data['grupo']}'" : 'NULL') . ', `grupo_codigo`=' . (($data['grupo_codigo'] !== '' && $data['grupo_codigo'] !== NULL) ? "'{$data['grupo_codigo']}'" : 'NULL') . ', `serie`=' . (($data['serie'] !== '' && $data['serie'] !== NULL) ? "'{$data['serie']}'" : 'NULL') . ', `serie_codigo`=' . (($data['serie_codigo'] !== '' && $data['serie_codigo'] !== NULL) ? "'{$data['serie_codigo']}'" : 'NULL') . ', `subserie`=' . (($data['subserie'] !== '' && $data['subserie'] !== NULL) ? "'{$data['subserie']}'" : 'NULL') . ', `tipologia`=' . (($data['tipologia'] !== '' && $data['tipologia'] !== NULL) ? "'{$data['tipologia']}'" : 'NULL') . ', `genero`=' . (($data['genero'] !== '' && $data['genero'] !== NULL) ? "'{$data['genero']}'" : 'NULL') . ', `forma`=' . (($data['forma'] !== '' && $data['forma'] !== NULL) ? "'{$data['forma']}'" : 'NULL') . ', `formato`=' . (($data['formato'] !== '' && $data['formato'] !== NULL) ? "'{$data['formato']}'" : 'NULL') . ', `escritura`=' . (($data['escritura'] !== '' && $data['escritura'] !== NULL) ? "'{$data['escritura']}'" : 'NULL') . ', `suporte`=' . (($data['suporte'] !== '' && $data['suporte'] !== NULL) ? "'{$data['suporte']}'" : 'NULL') . ', `dimensao`=' . (($data['dimensao'] !== '' && $data['dimensao'] !== NULL) ? "'{$data['dimensao']}'" : 'NULL') . ', `estado_conservacao`=' . (($data['estado_conservacao'] !== '' && $data['estado_conservacao'] !== NULL) ? "'{$data['estado_conservacao']}'" : 'NULL') . ', `observacoes`=' . (($data['observacoes'] !== '' && $data['observacoes'] !== NULL) ? "'{$data['observacoes']}'" : 'NULL') . ', `documentos_relacionados`=' . (($data['documentos_relacionados'] !== '' && $data['documentos_relacionados'] !== NULL) ? "'{$data['documentos_relacionados']}'" : 'NULL') . ', `numero_caixa`=' . (($data['numero_caixa'] !== '' && $data['numero_caixa'] !== NULL) ? "'{$data['numero_caixa']}'" : 'NULL') . ', `nome_caixa`=' . (($data['nome_caixa'] !== '' && $data['nome_caixa'] !== NULL) ? "'{$data['nome_caixa']}'" : 'NULL') . ', `numero_pasta`=' . (($data['numero_pasta'] !== '' && $data['numero_pasta'] !== NULL) ? "'{$data['numero_pasta']}'" : 'NULL') . ', `nome_pasta`=' . (($data['nome_pasta'] !== '' && $data['nome_pasta'] !== NULL) ? "'{$data['nome_pasta']}'" : 'NULL') . ', ' . ($data['upload'] != '' ? "`upload`='{$data['upload']}'" : '`upload`=NULL') . ', `usuario_cadastro`=' . "'{$data['usuario_cadastro']}'" . ', `publicar`=' . (($data['publicar'] !== '' && $data['publicar'] !== NULL) ? "'{$data['publicar']}'" : 'NULL'), $o);
	if($o['error']!=''){
		echo $o['error'];
		echo "<a href=\"item_view.php?addNew_x=1\">{$Translation['< back']}</a>";
		exit;
	}

	$recID = db_insert_id(db_link());

	// hook: item_after_insert
	if(function_exists('item_after_insert')){
		$res = sql("select * from `item` where `id`='" . makeSafe($recID, false) . "' limit 1", $eo);
		if($row = db_fetch_assoc($res)){
			$data = array_map('makeSafe', $row);
		}
		$data['selectedID'] = makeSafe($recID, false);
		$args=array();
		if(!item_after_insert($data, getMemberInfo(), $args)){ return $recID; }
	}

	// mm: save ownership data
	set_record_owner('item', $recID, getLoggedMemberID());

	return $recID;
}

function item_delete($selected_id, $AllowDeleteOfParents=false, $skipChecks=false){
	// insure referential integrity ...
	global $Translation;
	$selected_id=makeSafe($selected_id);

	// mm: can member delete record?
	$arrPerm=getTablePermissions('item');
	$ownerGroupID=sqlValue("select groupID from membership_userrecords where tableName='item' and pkValue='$selected_id'");
	$ownerMemberID=sqlValue("select lcase(memberID) from membership_userrecords where tableName='item' and pkValue='$selected_id'");
	if(($arrPerm[4]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[4]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[4]==3){ // allow delete?
		// delete allowed, so continue ...
	}else{
		return $Translation['You don\'t have enough permissions to delete this record'];
	}

	// hook: item_before_delete
	if(function_exists('item_before_delete')){
		$args=array();
		if(!item_before_delete($selected_id, $skipChecks, getMemberInfo(), $args))
			return $Translation['Couldn\'t delete this record'];
	}

	// child table: item
	$res = sql("select `id` from `item` where `id`='$selected_id'", $eo);
	$id = db_fetch_row($res);
	$rires = sql("select count(1) from `item` where `documentos_relacionados`='".addslashes($id[0])."'", $eo);
	$rirow = db_fetch_row($rires);
	if($rirow[0] && !$AllowDeleteOfParents && !$skipChecks){
		$RetMsg = $Translation["couldn't delete"];
		$RetMsg = str_replace("<RelatedRecords>", $rirow[0], $RetMsg);
		$RetMsg = str_replace("<TableName>", "item", $RetMsg);
		return $RetMsg;
	}elseif($rirow[0] && $AllowDeleteOfParents && !$skipChecks){
		$RetMsg = $Translation["confirm delete"];
		$RetMsg = str_replace("<RelatedRecords>", $rirow[0], $RetMsg);
		$RetMsg = str_replace("<TableName>", "item", $RetMsg);
		$RetMsg = str_replace("<Delete>", "<input type=\"button\" class=\"button\" value=\"".$Translation['yes']."\" onClick=\"window.location='item_view.php?SelectedID=".urlencode($selected_id)."&delete_x=1&confirmed=1';\">", $RetMsg);
		$RetMsg = str_replace("<Cancel>", "<input type=\"button\" class=\"button\" value=\"".$Translation['no']."\" onClick=\"window.location='item_view.php?SelectedID=".urlencode($selected_id)."';\">", $RetMsg);
		return $RetMsg;
	}

	// delete file stored in the 'upload' field
	$res = sql("select `upload` from `item` where `id`='$selected_id'", $eo);
	if($row=@db_fetch_row($res)){
		if($row[0]!=''){
			@unlink(getUploadDir('').$row[0]);
		}
	}

	sql("delete from `item` where `id`='$selected_id'", $eo);

	// hook: item_after_delete
	if(function_exists('item_after_delete')){
		$args=array();
		item_after_delete($selected_id, getMemberInfo(), $args);
	}

	// mm: delete ownership data
	sql("delete from membership_userrecords where tableName='item' and pkValue='$selected_id'", $eo);
}

function item_update($selected_id){
	global $Translation;

	// mm: can member edit record?
	$arrPerm=getTablePermissions('item');
	$ownerGroupID=sqlValue("select groupID from membership_userrecords where tableName='item' and pkValue='".makeSafe($selected_id)."'");
	$ownerMemberID=sqlValue("select lcase(memberID) from membership_userrecords where tableName='item' and pkValue='".makeSafe($selected_id)."'");
	if(($arrPerm[3]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[3]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[3]==3){ // allow update?
		// update allowed, so continue ...
	}else{
		return false;
	}

	$data['titulo'] = makeSafe($_REQUEST['titulo']);
		if($data['titulo'] == empty_lookup_value){ $data['titulo'] = ''; }
	$data['titulo_atribuido'] = makeSafe($_REQUEST['titulo_atribuido']);
		if($data['titulo_atribuido'] == empty_lookup_value){ $data['titulo_atribuido'] = ''; }
	$data['descricao'] = br2nl(makeSafe($_REQUEST['descricao']));
	$data['date'] = intval($_REQUEST['dateYear']) . '-' . intval($_REQUEST['dateMonth']) . '-' . intval($_REQUEST['dateDay']);
	$data['date'] = parseMySQLDate($data['date'], '');
	$data['data_livre'] = makeSafe($_REQUEST['data_livre']);
		if($data['data_livre'] == empty_lookup_value){ $data['data_livre'] = ''; }
	$data['data_atribuida'] = makeSafe($_REQUEST['data_atribuida']);
		if($data['data_atribuida'] == empty_lookup_value){ $data['data_atribuida'] = ''; }
	$data['autoria'] = makeSafe($_REQUEST['autoria']);
		if($data['autoria'] == empty_lookup_value){ $data['autoria'] = ''; }
	$data['quantidade'] = makeSafe($_REQUEST['quantidade']);
		if($data['quantidade'] == empty_lookup_value){ $data['quantidade'] = ''; }
	$data['idioma'] = makeSafe($_REQUEST['idioma']);
		if($data['idioma'] == empty_lookup_value){ $data['idioma'] = ''; }
	$data['local_producao'] = makeSafe($_REQUEST['local_producao']);
		if($data['local_producao'] == empty_lookup_value){ $data['local_producao'] = ''; }
	$data['local_publicacao_veiculo'] = makeSafe($_REQUEST['local_publicacao_veiculo']);
		if($data['local_publicacao_veiculo'] == empty_lookup_value){ $data['local_publicacao_veiculo'] = ''; }
	$data['local_publicacao'] = makeSafe($_REQUEST['local_publicacao']);
		if($data['local_publicacao'] == empty_lookup_value){ $data['local_publicacao'] = ''; }
	$data['tipo_publicacao'] = makeSafe($_REQUEST['tipo_publicacao']);
		if($data['tipo_publicacao'] == empty_lookup_value){ $data['tipo_publicacao'] = ''; }
	$data['identificacao'] = makeSafe($_REQUEST['identificacao']);
		if($data['identificacao'] == empty_lookup_value){ $data['identificacao'] = ''; }
	if($data['identificacao']==''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Identifica&#231;&#227;o:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	$data['colecao'] = makeSafe($_REQUEST['colecao']);
		if($data['colecao'] == empty_lookup_value){ $data['colecao'] = ''; }
	if($data['colecao']==''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Cole&#231;&#227;o:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	$data['colecao_codigo'] = makeSafe($_REQUEST['colecao']);
		if($data['colecao_codigo'] == empty_lookup_value){ $data['colecao_codigo'] = ''; }
	$data['grupo'] = makeSafe($_REQUEST['grupo']);
		if($data['grupo'] == empty_lookup_value){ $data['grupo'] = ''; }
	if($data['grupo']==''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Grupo:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	$data['grupo_codigo'] = makeSafe($_REQUEST['grupo']);
		if($data['grupo_codigo'] == empty_lookup_value){ $data['grupo_codigo'] = ''; }
	$data['serie'] = makeSafe($_REQUEST['serie']);
		if($data['serie'] == empty_lookup_value){ $data['serie'] = ''; }
	if($data['serie']==''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'S&#233;rie:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	$data['serie_codigo'] = makeSafe($_REQUEST['serie']);
		if($data['serie_codigo'] == empty_lookup_value){ $data['serie_codigo'] = ''; }
	$data['subserie'] = makeSafe($_REQUEST['subserie']);
		if($data['subserie'] == empty_lookup_value){ $data['subserie'] = ''; }
	$data['numero_serie'] = makeSafe($_REQUEST['numero_serie']);
		if($data['numero_serie'] == empty_lookup_value){ $data['numero_serie'] = ''; }
	$data['tipologia'] = makeSafe($_REQUEST['tipologia']);
		if($data['tipologia'] == empty_lookup_value){ $data['tipologia'] = ''; }
	if($data['tipologia']==''){
		echo StyleSheet() . "\n\n<div class=\"alert alert-danger\">{$Translation['error:']} 'Tipologia / Esp&#233;cie:': {$Translation['field not null']}<br><br>";
		echo '<a href="" onclick="history.go(-1); return false;">'.$Translation['< back'].'</a></div>';
		exit;
	}
	$data['genero'] = makeSafe($_REQUEST['genero']);
		if($data['genero'] == empty_lookup_value){ $data['genero'] = ''; }
	if(is_array($_REQUEST['forma'])){
		$MultipleSeparator = ', ';
		foreach($_REQUEST['forma'] as $k => $v)
			$data['forma'] .= makeSafe($v) . $MultipleSeparator;
		$data['forma']=substr($data['forma'], 0, -1 * strlen($MultipleSeparator));
	}else{
		$data['forma']='';
	}
	$data['formato'] = makeSafe($_REQUEST['formato']);
		if($data['formato'] == empty_lookup_value){ $data['formato'] = ''; }
	if(is_array($_REQUEST['escritura'])){
		$MultipleSeparator = ', ';
		foreach($_REQUEST['escritura'] as $k => $v)
			$data['escritura'] .= makeSafe($v) . $MultipleSeparator;
		$data['escritura']=substr($data['escritura'], 0, -1 * strlen($MultipleSeparator));
	}else{
		$data['escritura']='';
	}
	$data['suporte'] = makeSafe($_REQUEST['suporte']);
		if($data['suporte'] == empty_lookup_value){ $data['suporte'] = ''; }
	$data['dimensao'] = makeSafe($_REQUEST['dimensao']);
		if($data['dimensao'] == empty_lookup_value){ $data['dimensao'] = ''; }
	if(is_array($_REQUEST['estado_conservacao'])){
		$MultipleSeparator = ', ';
		foreach($_REQUEST['estado_conservacao'] as $k => $v)
			$data['estado_conservacao'] .= makeSafe($v) . $MultipleSeparator;
		$data['estado_conservacao']=substr($data['estado_conservacao'], 0, -1 * strlen($MultipleSeparator));
	}else{
		$data['estado_conservacao']='';
	}
	$data['observacoes'] = br2nl(makeSafe($_REQUEST['observacoes']));
	$data['documentos_relacionados'] = makeSafe($_REQUEST['documentos_relacionados']);
		if($data['documentos_relacionados'] == empty_lookup_value){ $data['documentos_relacionados'] = ''; }
	$data['numero_caixa'] = makeSafe($_REQUEST['numero_caixa']);
		if($data['numero_caixa'] == empty_lookup_value){ $data['numero_caixa'] = ''; }
	$data['nome_caixa'] = makeSafe($_REQUEST['nome_caixa']);
		if($data['nome_caixa'] == empty_lookup_value){ $data['nome_caixa'] = ''; }
	$data['numero_pasta'] = makeSafe($_REQUEST['numero_pasta']);
		if($data['numero_pasta'] == empty_lookup_value){ $data['numero_pasta'] = ''; }
	$data['nome_pasta'] = makeSafe($_REQUEST['nome_pasta']);
		if($data['nome_pasta'] == empty_lookup_value){ $data['nome_pasta'] = ''; }
	$data['usuario_alteracao'] = parseCode('<%%editorUsername%%>-<%%editingDateTime%%>', false);
	$data['publicar'] = makeSafe($_REQUEST['publicar']);
		if($data['publicar'] == empty_lookup_value){ $data['publicar'] = ''; }
	$data['selectedID']=makeSafe($selected_id);
	if($_REQUEST['upload_remove'] == 1){
		$data['upload'] = '';
		// delete file from server
		$res = sql("select `upload` from `item` where `id`='".makeSafe($selected_id)."'", $eo);
		if($row=@db_fetch_row($res)){
			if($row[0]!=''){
				@unlink(getUploadDir('').$row[0]);
			}
		}
	}else{
		$data['upload'] = PrepareUploadedFile('upload', 20480000, 'txt|doc|docx|docm|odt|pdf|rtf', false, "");
		// delete file from server
		if($data['upload'] != ''){
			$res = sql("select `upload` from `item` where `id`='".makeSafe($selected_id)."'", $eo);
			if($row=@db_fetch_row($res)){
				if($row[0]!=''){
					@unlink(getUploadDir('').$row[0]);
				}
			}
		}
	}

	// hook: item_before_update
	if(function_exists('item_before_update')){
		$args=array();
		if(!item_before_update($data, getMemberInfo(), $args)){ return false; }
	}

	$o=array('silentErrors' => true);
	sql('update `item` set       `titulo`=' . (($data['titulo'] !== '' && $data['titulo'] !== NULL) ? "'{$data['titulo']}'" : 'NULL') . ', `titulo_atribuido`=' . (($data['titulo_atribuido'] !== '' && $data['titulo_atribuido'] !== NULL) ? "'{$data['titulo_atribuido']}'" : 'NULL') . ', `descricao`=' . (($data['descricao'] !== '' && $data['descricao'] !== NULL) ? "'{$data['descricao']}'" : 'NULL') . ', `date`=' . (($data['date'] !== '' && $data['date'] !== NULL) ? "'{$data['date']}'" : 'NULL') . ', `data_livre`=' . (($data['data_livre'] !== '' && $data['data_livre'] !== NULL) ? "'{$data['data_livre']}'" : 'NULL') . ', `data_atribuida`=' . (($data['data_atribuida'] !== '' && $data['data_atribuida'] !== NULL) ? "'{$data['data_atribuida']}'" : 'NULL') . ', `autoria`=' . (($data['autoria'] !== '' && $data['autoria'] !== NULL) ? "'{$data['autoria']}'" : 'NULL') . ', `quantidade`=' . (($data['quantidade'] !== '' && $data['quantidade'] !== NULL) ? "'{$data['quantidade']}'" : 'NULL') . ', `idioma`=' . (($data['idioma'] !== '' && $data['idioma'] !== NULL) ? "'{$data['idioma']}'" : 'NULL') . ', `local_producao`=' . (($data['local_producao'] !== '' && $data['local_producao'] !== NULL) ? "'{$data['local_producao']}'" : 'NULL') . ', `local_publicacao_veiculo`=' . (($data['local_publicacao_veiculo'] !== '' && $data['local_publicacao_veiculo'] !== NULL) ? "'{$data['local_publicacao_veiculo']}'" : 'NULL') . ', `local_publicacao`=' . (($data['local_publicacao'] !== '' && $data['local_publicacao'] !== NULL) ? "'{$data['local_publicacao']}'" : 'NULL') . ', `tipo_publicacao`=' . (($data['tipo_publicacao'] !== '' && $data['tipo_publicacao'] !== NULL) ? "'{$data['tipo_publicacao']}'" : 'NULL') . ', `identificacao`=' . (($data['identificacao'] !== '' && $data['identificacao'] !== NULL) ? "'{$data['identificacao']}'" : 'NULL') . ', `colecao`=' . (($data['colecao'] !== '' && $data['colecao'] !== NULL) ? "'{$data['colecao']}'" : 'NULL') . ', `colecao_codigo`=' . (($data['colecao_codigo'] !== '' && $data['colecao_codigo'] !== NULL) ? "'{$data['colecao_codigo']}'" : 'NULL') . ', `grupo`=' . (($data['grupo'] !== '' && $data['grupo'] !== NULL) ? "'{$data['grupo']}'" : 'NULL') . ', `grupo_codigo`=' . (($data['grupo_codigo'] !== '' && $data['grupo_codigo'] !== NULL) ? "'{$data['grupo_codigo']}'" : 'NULL') . ', `serie`=' . (($data['serie'] !== '' && $data['serie'] !== NULL) ? "'{$data['serie']}'" : 'NULL') . ', `serie_codigo`=' . (($data['serie_codigo'] !== '' && $data['serie_codigo'] !== NULL) ? "'{$data['serie_codigo']}'" : 'NULL') . ', `subserie`=' . (($data['subserie'] !== '' && $data['subserie'] !== NULL) ? "'{$data['subserie']}'" : 'NULL') . ', `tipologia`=' . (($data['tipologia'] !== '' && $data['tipologia'] !== NULL) ? "'{$data['tipologia']}'" : 'NULL') . ', `genero`=' . (($data['genero'] !== '' && $data['genero'] !== NULL) ? "'{$data['genero']}'" : 'NULL') . ', `forma`=' . (($data['forma'] !== '' && $data['forma'] !== NULL) ? "'{$data['forma']}'" : 'NULL') . ', `formato`=' . (($data['formato'] !== '' && $data['formato'] !== NULL) ? "'{$data['formato']}'" : 'NULL') . ', `escritura`=' . (($data['escritura'] !== '' && $data['escritura'] !== NULL) ? "'{$data['escritura']}'" : 'NULL') . ', `suporte`=' . (($data['suporte'] !== '' && $data['suporte'] !== NULL) ? "'{$data['suporte']}'" : 'NULL') . ', `dimensao`=' . (($data['dimensao'] !== '' && $data['dimensao'] !== NULL) ? "'{$data['dimensao']}'" : 'NULL') . ', `estado_conservacao`=' . (($data['estado_conservacao'] !== '' && $data['estado_conservacao'] !== NULL) ? "'{$data['estado_conservacao']}'" : 'NULL') . ', `observacoes`=' . (($data['observacoes'] !== '' && $data['observacoes'] !== NULL) ? "'{$data['observacoes']}'" : 'NULL') . ', `documentos_relacionados`=' . (($data['documentos_relacionados'] !== '' && $data['documentos_relacionados'] !== NULL) ? "'{$data['documentos_relacionados']}'" : 'NULL') . ', `numero_caixa`=' . (($data['numero_caixa'] !== '' && $data['numero_caixa'] !== NULL) ? "'{$data['numero_caixa']}'" : 'NULL') . ', `nome_caixa`=' . (($data['nome_caixa'] !== '' && $data['nome_caixa'] !== NULL) ? "'{$data['nome_caixa']}'" : 'NULL') . ', `numero_pasta`=' . (($data['numero_pasta'] !== '' && $data['numero_pasta'] !== NULL) ? "'{$data['numero_pasta']}'" : 'NULL') . ', `nome_pasta`=' . (($data['nome_pasta'] !== '' && $data['nome_pasta'] !== NULL) ? "'{$data['nome_pasta']}'" : 'NULL') . ', ' . ($data['upload']!='' ? "`upload`='{$data['upload']}'" : ($_REQUEST['upload_remove'] != 1 ? '`upload`=`upload`' : '`upload`=NULL')) . ', `usuario_cadastro`=`usuario_cadastro`' . ', `usuario_alteracao`=' . "'{$data['usuario_alteracao']}'" . ', `publicar`=' . (($data['publicar'] !== '' && $data['publicar'] !== NULL) ? "'{$data['publicar']}'" : 'NULL') . " where `id`='".makeSafe($selected_id)."'", $o);
	if($o['error']!=''){
		echo $o['error'];
		echo '<a href="item_view.php?SelectedID='.urlencode($selected_id)."\">{$Translation['< back']}</a>";
		exit;
	}


	// hook: item_after_update
	if(function_exists('item_after_update')){
		$res = sql("SELECT * FROM `item` WHERE `id`='{$data['selectedID']}' LIMIT 1", $eo);
		if($row = db_fetch_assoc($res)){
			$data = array_map('makeSafe', $row);
		}
		$data['selectedID'] = $data['id'];
		$args = array();
		if(!item_after_update($data, getMemberInfo(), $args)){ return; }
	}

	// mm: update ownership data
	sql("update membership_userrecords set dateUpdated='".time()."' where tableName='item' and pkValue='".makeSafe($selected_id)."'", $eo);

}

function item_form($selected_id = '', $AllowUpdate = 1, $AllowInsert = 1, $AllowDelete = 1, $ShowCancel = 0, $TemplateDV = '', $TemplateDVP = ''){
	// function to return an editable form for a table records
	// and fill it with data of record whose ID is $selected_id. If $selected_id
	// is empty, an empty form is shown, with only an 'Add New'
	// button displayed.

	global $Translation;

	// mm: get table permissions
	$arrPerm=getTablePermissions('item');
	if(!$arrPerm[1] && $selected_id==''){ return ''; }
	$AllowInsert = ($arrPerm[1] ? true : false);
	// print preview?
	$dvprint = false;
	if($selected_id && $_REQUEST['dvprint_x'] != ''){
		$dvprint = true;
	}

	$filterer_idioma = thisOr(undo_magic_quotes($_REQUEST['filterer_idioma']), '');
	$filterer_local_publicacao_veiculo = thisOr(undo_magic_quotes($_REQUEST['filterer_local_publicacao_veiculo']), '');
	$filterer_tipo_publicacao = thisOr(undo_magic_quotes($_REQUEST['filterer_tipo_publicacao']), '');
	$filterer_colecao = thisOr(undo_magic_quotes($_REQUEST['filterer_colecao']), '');
	$filterer_grupo = thisOr(undo_magic_quotes($_REQUEST['filterer_grupo']), '');
	$filterer_serie = thisOr(undo_magic_quotes($_REQUEST['filterer_serie']), '');
	$filterer_subserie = thisOr(undo_magic_quotes($_REQUEST['filterer_subserie']), '');
	$filterer_tipologia = thisOr(undo_magic_quotes($_REQUEST['filterer_tipologia']), '');
	$filterer_genero = thisOr(undo_magic_quotes($_REQUEST['filterer_genero']), '');
	$filterer_formato = thisOr(undo_magic_quotes($_REQUEST['filterer_formato']), '');
	$filterer_suporte = thisOr(undo_magic_quotes($_REQUEST['filterer_suporte']), '');
	$filterer_documentos_relacionados = thisOr(undo_magic_quotes($_REQUEST['filterer_documentos_relacionados']), '');
	$filterer_numero_caixa = thisOr(undo_magic_quotes($_REQUEST['filterer_numero_caixa']), '');
	$filterer_nome_caixa = thisOr(undo_magic_quotes($_REQUEST['filterer_nome_caixa']), '');
	$filterer_numero_pasta = thisOr(undo_magic_quotes($_REQUEST['filterer_numero_pasta']), '');
	$filterer_nome_pasta = thisOr(undo_magic_quotes($_REQUEST['filterer_nome_pasta']), '');

	// populate filterers, starting from children to grand-parents
	if($filterer_grupo && !$filterer_colecao) $filterer_colecao = sqlValue("select colecao from grupo where id='" . makeSafe($filterer_grupo) . "'");
	if($filterer_serie && !$filterer_grupo) $filterer_grupo = sqlValue("select grupo from serie where id='" . makeSafe($filterer_serie) . "'");
	if($filterer_subserie && !$filterer_serie) $filterer_serie = sqlValue("select serie from subserie where id='" . makeSafe($filterer_subserie) . "'");
	if($filterer_nome_caixa && !$filterer_numero_caixa) $filterer_numero_caixa = sqlValue("select numero_caixa from nome_caixa where id='" . makeSafe($filterer_nome_caixa) . "'");
	if($filterer_numero_pasta && !$filterer_nome_caixa) $filterer_nome_caixa = sqlValue("select  from numero_pasta where id='" . makeSafe($filterer_numero_pasta) . "'");
	if($filterer_nome_pasta && !$filterer_numero_pasta) $filterer_numero_pasta = sqlValue("select numero_pasta from nome_pasta where id='" . makeSafe($filterer_nome_pasta) . "'");

	// unique random identifier
	$rnd1 = ($dvprint ? rand(1000000, 9999999) : '');
	// combobox: date
	$combo_date = new DateCombo;
	$combo_date->DateFormat = "dmy";
	$combo_date->MinYear = 1900;
	$combo_date->MaxYear = 2100;
	$combo_date->DefaultDate = parseMySQLDate('', '');
	$combo_date->MonthNames = $Translation['month names'];
	$combo_date->NamePrefix = 'date';
	// combobox: idioma
	$combo_idioma = new DataCombo;
	// combobox: local_publicacao_veiculo
	$combo_local_publicacao_veiculo = new DataCombo;
	// combobox: tipo_publicacao
	$combo_tipo_publicacao = new DataCombo;
	// combobox: colecao
	$combo_colecao = new DataCombo;
	// combobox: grupo, filterable by: colecao
	$combo_grupo = new DataCombo;
	// combobox: serie, filterable by: grupo
	$combo_serie = new DataCombo;
	// combobox: subserie, filterable by: serie
	$combo_subserie = new DataCombo;
	// combobox: tipologia
	$combo_tipologia = new DataCombo;
	// combobox: genero
	$combo_genero = new DataCombo;
	// combobox: forma
	$combo_forma = new Combo;
	$combo_forma->ListType = 3;
	$combo_forma->MultipleSeparator = ', ';
	$combo_forma->ListBoxHeight = 10;
	$combo_forma->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/item.forma.csv')){
		$forma_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/item.forma.csv')));
		$combo_forma->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($forma_data)));
		$combo_forma->ListData = $combo_forma->ListItem;
	}else{
		$combo_forma->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Original;;C&#243;pia;;Rascunho")));
		$combo_forma->ListData = $combo_forma->ListItem;
	}
	$combo_forma->SelectName = 'forma';
	// combobox: formato
	$combo_formato = new DataCombo;
	// combobox: escritura
	$combo_escritura = new Combo;
	$combo_escritura->ListType = 3;
	$combo_escritura->MultipleSeparator = ', ';
	$combo_escritura->ListBoxHeight = 10;
	$combo_escritura->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/item.escritura.csv')){
		$escritura_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/item.escritura.csv')));
		$combo_escritura->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($escritura_data)));
		$combo_escritura->ListData = $combo_escritura->ListItem;
	}else{
		$combo_escritura->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Manuscrito;;Impresso;;Datilografado")));
		$combo_escritura->ListData = $combo_escritura->ListItem;
	}
	$combo_escritura->SelectName = 'escritura';
	// combobox: suporte
	$combo_suporte = new DataCombo;
	// combobox: estado_conservacao
	$combo_estado_conservacao = new Combo;
	$combo_estado_conservacao->ListType = 3;
	$combo_estado_conservacao->MultipleSeparator = ', ';
	$combo_estado_conservacao->ListBoxHeight = 10;
	$combo_estado_conservacao->RadiosPerLine = 1;
	if(is_file(dirname(__FILE__).'/hooks/item.estado_conservacao.csv')){
		$estado_conservacao_data = addslashes(implode('', @file(dirname(__FILE__).'/hooks/item.estado_conservacao.csv')));
		$combo_estado_conservacao->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions($estado_conservacao_data)));
		$combo_estado_conservacao->ListData = $combo_estado_conservacao->ListItem;
	}else{
		$combo_estado_conservacao->ListItem = explode('||', entitiesToUTF8(convertLegacyOptions("Bom;;Rasgado;;Papel Acidificado / Amarelado;;Perda de Peda&#231;os;;Furado;;Dobrado;;Fungos;;Oxidado;;Manchado;;Outros")));
		$combo_estado_conservacao->ListData = $combo_estado_conservacao->ListItem;
	}
	$combo_estado_conservacao->SelectName = 'estado_conservacao';
	// combobox: documentos_relacionados
	$combo_documentos_relacionados = new DataCombo;
	// combobox: numero_caixa
	$combo_numero_caixa = new DataCombo;
	// combobox: nome_caixa, filterable by: numero_caixa
	$combo_nome_caixa = new DataCombo;
	// combobox: numero_pasta, filterable by: nome_caixa
	$combo_numero_pasta = new DataCombo;
	// combobox: nome_pasta, filterable by: numero_pasta
	$combo_nome_pasta = new DataCombo;

	if($selected_id){
		// mm: check member permissions
		if(!$arrPerm[2]){
			return "";
		}
		// mm: who is the owner?
		$ownerGroupID=sqlValue("select groupID from membership_userrecords where tableName='item' and pkValue='".makeSafe($selected_id)."'");
		$ownerMemberID=sqlValue("select lcase(memberID) from membership_userrecords where tableName='item' and pkValue='".makeSafe($selected_id)."'");
		if($arrPerm[2]==1 && getLoggedMemberID()!=$ownerMemberID){
			return "";
		}
		if($arrPerm[2]==2 && getLoggedGroupID()!=$ownerGroupID){
			return "";
		}

		// can edit?
		if(($arrPerm[3]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[3]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[3]==3){
			$AllowUpdate=1;
		}else{
			$AllowUpdate=0;
		}

		$res = sql("select * from `item` where `id`='".makeSafe($selected_id)."'", $eo);
		if(!($row = db_fetch_array($res))){
			return error_message($Translation['No records found'], 'item_view.php', false);
		}
		$urow = $row; /* unsanitized data */
		$hc = new CI_Input();
		$row = $hc->xss_clean($row); /* sanitize data */
		$combo_date->DefaultDate = $row['date'];
		$combo_idioma->SelectedData = $row['idioma'];
		$combo_local_publicacao_veiculo->SelectedData = $row['local_publicacao_veiculo'];
		$combo_tipo_publicacao->SelectedData = $row['tipo_publicacao'];
		$combo_colecao->SelectedData = $row['colecao'];
		$combo_grupo->SelectedData = $row['grupo'];
		$combo_serie->SelectedData = $row['serie'];
		$combo_subserie->SelectedData = $row['subserie'];
		$combo_tipologia->SelectedData = $row['tipologia'];
		$combo_genero->SelectedData = $row['genero'];
		$combo_forma->SelectedData = $row['forma'];
		$combo_formato->SelectedData = $row['formato'];
		$combo_escritura->SelectedData = $row['escritura'];
		$combo_suporte->SelectedData = $row['suporte'];
		$combo_estado_conservacao->SelectedData = $row['estado_conservacao'];
		$combo_documentos_relacionados->SelectedData = $row['documentos_relacionados'];
		$combo_numero_caixa->SelectedData = $row['numero_caixa'];
		$combo_nome_caixa->SelectedData = $row['nome_caixa'];
		$combo_numero_pasta->SelectedData = $row['numero_pasta'];
		$combo_nome_pasta->SelectedData = $row['nome_pasta'];
	}else{
		$combo_idioma->SelectedData = $filterer_idioma;
		$combo_local_publicacao_veiculo->SelectedData = $filterer_local_publicacao_veiculo;
		$combo_tipo_publicacao->SelectedData = $filterer_tipo_publicacao;
		$combo_colecao->SelectedData = $filterer_colecao;
		$combo_grupo->SelectedData = $filterer_grupo;
		$combo_serie->SelectedData = $filterer_serie;
		$combo_subserie->SelectedData = $filterer_subserie;
		$combo_tipologia->SelectedData = $filterer_tipologia;
		$combo_genero->SelectedData = $filterer_genero;
		$combo_formato->SelectedData = $filterer_formato;
		$combo_suporte->SelectedData = $filterer_suporte;
		$combo_documentos_relacionados->SelectedData = $filterer_documentos_relacionados;
		$combo_numero_caixa->SelectedData = $filterer_numero_caixa;
		$combo_nome_caixa->SelectedData = $filterer_nome_caixa;
		$combo_numero_pasta->SelectedData = $filterer_numero_pasta;
		$combo_nome_pasta->SelectedData = $filterer_nome_pasta;
	}
	$combo_idioma->HTML = '<span id="idioma-container' . $rnd1 . '"></span><input type="hidden" name="idioma" id="idioma' . $rnd1 . '" value="' . html_attr($combo_idioma->SelectedData) . '">';
	$combo_idioma->MatchText = '<span id="idioma-container-readonly' . $rnd1 . '"></span><input type="hidden" name="idioma" id="idioma' . $rnd1 . '" value="' . html_attr($combo_idioma->SelectedData) . '">';
	$combo_local_publicacao_veiculo->HTML = '<span id="local_publicacao_veiculo-container' . $rnd1 . '"></span><input type="hidden" name="local_publicacao_veiculo" id="local_publicacao_veiculo' . $rnd1 . '" value="' . html_attr($combo_local_publicacao_veiculo->SelectedData) . '">';
	$combo_local_publicacao_veiculo->MatchText = '<span id="local_publicacao_veiculo-container-readonly' . $rnd1 . '"></span><input type="hidden" name="local_publicacao_veiculo" id="local_publicacao_veiculo' . $rnd1 . '" value="' . html_attr($combo_local_publicacao_veiculo->SelectedData) . '">';
	$combo_tipo_publicacao->HTML = '<span id="tipo_publicacao-container' . $rnd1 . '"></span><input type="hidden" name="tipo_publicacao" id="tipo_publicacao' . $rnd1 . '" value="' . html_attr($combo_tipo_publicacao->SelectedData) . '">';
	$combo_tipo_publicacao->MatchText = '<span id="tipo_publicacao-container-readonly' . $rnd1 . '"></span><input type="hidden" name="tipo_publicacao" id="tipo_publicacao' . $rnd1 . '" value="' . html_attr($combo_tipo_publicacao->SelectedData) . '">';
	$combo_colecao->HTML = '<span id="colecao-container' . $rnd1 . '"></span><input type="hidden" name="colecao" id="colecao' . $rnd1 . '" value="' . html_attr($combo_colecao->SelectedData) . '">';
	$combo_colecao->MatchText = '<span id="colecao-container-readonly' . $rnd1 . '"></span><input type="hidden" name="colecao" id="colecao' . $rnd1 . '" value="' . html_attr($combo_colecao->SelectedData) . '">';
	$combo_grupo->HTML = '<span id="grupo-container' . $rnd1 . '"></span><input type="hidden" name="grupo" id="grupo' . $rnd1 . '" value="' . html_attr($combo_grupo->SelectedData) . '">';
	$combo_grupo->MatchText = '<span id="grupo-container-readonly' . $rnd1 . '"></span><input type="hidden" name="grupo" id="grupo' . $rnd1 . '" value="' . html_attr($combo_grupo->SelectedData) . '">';
	$combo_serie->HTML = '<span id="serie-container' . $rnd1 . '"></span><input type="hidden" name="serie" id="serie' . $rnd1 . '" value="' . html_attr($combo_serie->SelectedData) . '">';
	$combo_serie->MatchText = '<span id="serie-container-readonly' . $rnd1 . '"></span><input type="hidden" name="serie" id="serie' . $rnd1 . '" value="' . html_attr($combo_serie->SelectedData) . '">';
	$combo_subserie->HTML = '<span id="subserie-container' . $rnd1 . '"></span><input type="hidden" name="subserie" id="subserie' . $rnd1 . '" value="' . html_attr($combo_subserie->SelectedData) . '">';
	$combo_subserie->MatchText = '<span id="subserie-container-readonly' . $rnd1 . '"></span><input type="hidden" name="subserie" id="subserie' . $rnd1 . '" value="' . html_attr($combo_subserie->SelectedData) . '">';
	$combo_tipologia->HTML = '<span id="tipologia-container' . $rnd1 . '"></span><input type="hidden" name="tipologia" id="tipologia' . $rnd1 . '" value="' . html_attr($combo_tipologia->SelectedData) . '">';
	$combo_tipologia->MatchText = '<span id="tipologia-container-readonly' . $rnd1 . '"></span><input type="hidden" name="tipologia" id="tipologia' . $rnd1 . '" value="' . html_attr($combo_tipologia->SelectedData) . '">';
	$combo_genero->HTML = '<span id="genero-container' . $rnd1 . '"></span><input type="hidden" name="genero" id="genero' . $rnd1 . '" value="' . html_attr($combo_genero->SelectedData) . '">';
	$combo_genero->MatchText = '<span id="genero-container-readonly' . $rnd1 . '"></span><input type="hidden" name="genero" id="genero' . $rnd1 . '" value="' . html_attr($combo_genero->SelectedData) . '">';
	$combo_forma->Render();
	$combo_formato->HTML = '<span id="formato-container' . $rnd1 . '"></span><input type="hidden" name="formato" id="formato' . $rnd1 . '" value="' . html_attr($combo_formato->SelectedData) . '">';
	$combo_formato->MatchText = '<span id="formato-container-readonly' . $rnd1 . '"></span><input type="hidden" name="formato" id="formato' . $rnd1 . '" value="' . html_attr($combo_formato->SelectedData) . '">';
	$combo_escritura->Render();
	$combo_suporte->HTML = '<span id="suporte-container' . $rnd1 . '"></span><input type="hidden" name="suporte" id="suporte' . $rnd1 . '" value="' . html_attr($combo_suporte->SelectedData) . '">';
	$combo_suporte->MatchText = '<span id="suporte-container-readonly' . $rnd1 . '"></span><input type="hidden" name="suporte" id="suporte' . $rnd1 . '" value="' . html_attr($combo_suporte->SelectedData) . '">';
	$combo_estado_conservacao->Render();
	$combo_documentos_relacionados->HTML = '<span id="documentos_relacionados-container' . $rnd1 . '"></span><input type="hidden" name="documentos_relacionados" id="documentos_relacionados' . $rnd1 . '" value="' . html_attr($combo_documentos_relacionados->SelectedData) . '">';
	$combo_documentos_relacionados->MatchText = '<span id="documentos_relacionados-container-readonly' . $rnd1 . '"></span><input type="hidden" name="documentos_relacionados" id="documentos_relacionados' . $rnd1 . '" value="' . html_attr($combo_documentos_relacionados->SelectedData) . '">';
	$combo_numero_caixa->HTML = '<span id="numero_caixa-container' . $rnd1 . '"></span><input type="hidden" name="numero_caixa" id="numero_caixa' . $rnd1 . '" value="' . html_attr($combo_numero_caixa->SelectedData) . '">';
	$combo_numero_caixa->MatchText = '<span id="numero_caixa-container-readonly' . $rnd1 . '"></span><input type="hidden" name="numero_caixa" id="numero_caixa' . $rnd1 . '" value="' . html_attr($combo_numero_caixa->SelectedData) . '">';
	$combo_nome_caixa->HTML = '<span id="nome_caixa-container' . $rnd1 . '"></span><input type="hidden" name="nome_caixa" id="nome_caixa' . $rnd1 . '" value="' . html_attr($combo_nome_caixa->SelectedData) . '">';
	$combo_nome_caixa->MatchText = '<span id="nome_caixa-container-readonly' . $rnd1 . '"></span><input type="hidden" name="nome_caixa" id="nome_caixa' . $rnd1 . '" value="' . html_attr($combo_nome_caixa->SelectedData) . '">';
	$combo_numero_pasta->HTML = '<span id="numero_pasta-container' . $rnd1 . '"></span><input type="hidden" name="numero_pasta" id="numero_pasta' . $rnd1 . '" value="' . html_attr($combo_numero_pasta->SelectedData) . '">';
	$combo_numero_pasta->MatchText = '<span id="numero_pasta-container-readonly' . $rnd1 . '"></span><input type="hidden" name="numero_pasta" id="numero_pasta' . $rnd1 . '" value="' . html_attr($combo_numero_pasta->SelectedData) . '">';
	$combo_nome_pasta->HTML = '<span id="nome_pasta-container' . $rnd1 . '"></span><input type="hidden" name="nome_pasta" id="nome_pasta' . $rnd1 . '" value="' . html_attr($combo_nome_pasta->SelectedData) . '">';
	$combo_nome_pasta->MatchText = '<span id="nome_pasta-container-readonly' . $rnd1 . '"></span><input type="hidden" name="nome_pasta" id="nome_pasta' . $rnd1 . '" value="' . html_attr($combo_nome_pasta->SelectedData) . '">';

	ob_start();
	?>

	<script>
		// initial lookup values
		AppGini.current_idioma__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['idioma'] : $filterer_idioma); ?>"};
		AppGini.current_local_publicacao_veiculo__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['local_publicacao_veiculo'] : $filterer_local_publicacao_veiculo); ?>"};
		AppGini.current_tipo_publicacao__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['tipo_publicacao'] : $filterer_tipo_publicacao); ?>"};
		AppGini.current_colecao__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['colecao'] : $filterer_colecao); ?>"};
		AppGini.current_grupo__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['grupo'] : $filterer_grupo); ?>"};
		AppGini.current_serie__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['serie'] : $filterer_serie); ?>"};
		AppGini.current_subserie__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['subserie'] : $filterer_subserie); ?>"};
		AppGini.current_tipologia__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['tipologia'] : $filterer_tipologia); ?>"};
		AppGini.current_genero__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['genero'] : $filterer_genero); ?>"};
		AppGini.current_formato__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['formato'] : $filterer_formato); ?>"};
		AppGini.current_suporte__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['suporte'] : $filterer_suporte); ?>"};
		AppGini.current_documentos_relacionados__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['documentos_relacionados'] : $filterer_documentos_relacionados); ?>"};
		AppGini.current_numero_caixa__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['numero_caixa'] : $filterer_numero_caixa); ?>"};
		AppGini.current_nome_caixa__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['nome_caixa'] : $filterer_nome_caixa); ?>"};
		AppGini.current_numero_pasta__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['numero_pasta'] : $filterer_numero_pasta); ?>"};
		AppGini.current_nome_pasta__RAND__ = { text: "", value: "<?php echo addslashes($selected_id ? $urow['nome_pasta'] : $filterer_nome_pasta); ?>"};

		jQuery(function() {
			setTimeout(function(){
				if(typeof(idioma_reload__RAND__) == 'function') idioma_reload__RAND__();
				if(typeof(local_publicacao_veiculo_reload__RAND__) == 'function') local_publicacao_veiculo_reload__RAND__();
				if(typeof(tipo_publicacao_reload__RAND__) == 'function') tipo_publicacao_reload__RAND__();
				if(typeof(colecao_reload__RAND__) == 'function') colecao_reload__RAND__();
				<?php echo (!$AllowUpdate || $dvprint ? 'if(typeof(grupo_reload__RAND__) == \'function\') grupo_reload__RAND__(AppGini.current_colecao__RAND__.value);' : ''); ?>
				<?php echo (!$AllowUpdate || $dvprint ? 'if(typeof(serie_reload__RAND__) == \'function\') serie_reload__RAND__(AppGini.current_grupo__RAND__.value);' : ''); ?>
				<?php echo (!$AllowUpdate || $dvprint ? 'if(typeof(subserie_reload__RAND__) == \'function\') subserie_reload__RAND__(AppGini.current_serie__RAND__.value);' : ''); ?>
				if(typeof(tipologia_reload__RAND__) == 'function') tipologia_reload__RAND__();
				if(typeof(genero_reload__RAND__) == 'function') genero_reload__RAND__();
				if(typeof(formato_reload__RAND__) == 'function') formato_reload__RAND__();
				if(typeof(suporte_reload__RAND__) == 'function') suporte_reload__RAND__();
				if(typeof(documentos_relacionados_reload__RAND__) == 'function') documentos_relacionados_reload__RAND__();
				if(typeof(numero_caixa_reload__RAND__) == 'function') numero_caixa_reload__RAND__();
				<?php echo (!$AllowUpdate || $dvprint ? 'if(typeof(nome_caixa_reload__RAND__) == \'function\') nome_caixa_reload__RAND__(AppGini.current_numero_caixa__RAND__.value);' : ''); ?>
				<?php echo (!$AllowUpdate || $dvprint ? 'if(typeof(numero_pasta_reload__RAND__) == \'function\') numero_pasta_reload__RAND__(AppGini.current_nome_caixa__RAND__.value);' : ''); ?>
				<?php echo (!$AllowUpdate || $dvprint ? 'if(typeof(nome_pasta_reload__RAND__) == \'function\') nome_pasta_reload__RAND__(AppGini.current_numero_pasta__RAND__.value);' : ''); ?>
			}, 10); /* we need to slightly delay client-side execution of the above code to allow AppGini.ajaxCache to work */
		});
		function idioma_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#idioma-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_idioma__RAND__.value, t: 'item', f: 'idioma' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="idioma"]').val(resp.results[0].id);
							$j('[id=idioma-container-readonly__RAND__]').html('<span id="idioma-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=idioma_view_parent]').hide(); }else{ $j('.btn[id=idioma_view_parent]').show(); }


							if(typeof(idioma_update_autofills__RAND__) == 'function') idioma_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'idioma' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_idioma__RAND__.value = e.added.id;
				AppGini.current_idioma__RAND__.text = e.added.text;
				$j('[name="idioma"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=idioma_view_parent]').hide(); }else{ $j('.btn[id=idioma_view_parent]').show(); }


				if(typeof(idioma_update_autofills__RAND__) == 'function') idioma_update_autofills__RAND__();
			});

			if(!$j("#idioma-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_idioma__RAND__.value, t: 'item', f: 'idioma' },
					success: function(resp){
						$j('[name="idioma"]').val(resp.results[0].id);
						$j('[id=idioma-container-readonly__RAND__]').html('<span id="idioma-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=idioma_view_parent]').hide(); }else{ $j('.btn[id=idioma_view_parent]').show(); }

						if(typeof(idioma_update_autofills__RAND__) == 'function') idioma_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_idioma__RAND__.value, t: 'item', f: 'idioma' },
				success: function(resp){
					$j('[id=idioma-container__RAND__], [id=idioma-container-readonly__RAND__]').html('<span id="idioma-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=idioma_view_parent]').hide(); }else{ $j('.btn[id=idioma_view_parent]').show(); }

					if(typeof(idioma_update_autofills__RAND__) == 'function') idioma_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function local_publicacao_veiculo_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#local_publicacao_veiculo-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_local_publicacao_veiculo__RAND__.value, t: 'item', f: 'local_publicacao_veiculo' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="local_publicacao_veiculo"]').val(resp.results[0].id);
							$j('[id=local_publicacao_veiculo-container-readonly__RAND__]').html('<span id="local_publicacao_veiculo-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=local_comunicacao_view_parent]').hide(); }else{ $j('.btn[id=local_comunicacao_view_parent]').show(); }


							if(typeof(local_publicacao_veiculo_update_autofills__RAND__) == 'function') local_publicacao_veiculo_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'local_publicacao_veiculo' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_local_publicacao_veiculo__RAND__.value = e.added.id;
				AppGini.current_local_publicacao_veiculo__RAND__.text = e.added.text;
				$j('[name="local_publicacao_veiculo"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=local_comunicacao_view_parent]').hide(); }else{ $j('.btn[id=local_comunicacao_view_parent]').show(); }


				if(typeof(local_publicacao_veiculo_update_autofills__RAND__) == 'function') local_publicacao_veiculo_update_autofills__RAND__();
			});

			if(!$j("#local_publicacao_veiculo-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_local_publicacao_veiculo__RAND__.value, t: 'item', f: 'local_publicacao_veiculo' },
					success: function(resp){
						$j('[name="local_publicacao_veiculo"]').val(resp.results[0].id);
						$j('[id=local_publicacao_veiculo-container-readonly__RAND__]').html('<span id="local_publicacao_veiculo-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=local_comunicacao_view_parent]').hide(); }else{ $j('.btn[id=local_comunicacao_view_parent]').show(); }

						if(typeof(local_publicacao_veiculo_update_autofills__RAND__) == 'function') local_publicacao_veiculo_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_local_publicacao_veiculo__RAND__.value, t: 'item', f: 'local_publicacao_veiculo' },
				success: function(resp){
					$j('[id=local_publicacao_veiculo-container__RAND__], [id=local_publicacao_veiculo-container-readonly__RAND__]').html('<span id="local_publicacao_veiculo-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=local_comunicacao_view_parent]').hide(); }else{ $j('.btn[id=local_comunicacao_view_parent]').show(); }

					if(typeof(local_publicacao_veiculo_update_autofills__RAND__) == 'function') local_publicacao_veiculo_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function tipo_publicacao_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#tipo_publicacao-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_tipo_publicacao__RAND__.value, t: 'item', f: 'tipo_publicacao' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="tipo_publicacao"]').val(resp.results[0].id);
							$j('[id=tipo_publicacao-container-readonly__RAND__]').html('<span id="tipo_publicacao-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipo_publicacao_view_parent]').hide(); }else{ $j('.btn[id=tipo_publicacao_view_parent]').show(); }


							if(typeof(tipo_publicacao_update_autofills__RAND__) == 'function') tipo_publicacao_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'tipo_publicacao' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_tipo_publicacao__RAND__.value = e.added.id;
				AppGini.current_tipo_publicacao__RAND__.text = e.added.text;
				$j('[name="tipo_publicacao"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipo_publicacao_view_parent]').hide(); }else{ $j('.btn[id=tipo_publicacao_view_parent]').show(); }


				if(typeof(tipo_publicacao_update_autofills__RAND__) == 'function') tipo_publicacao_update_autofills__RAND__();
			});

			if(!$j("#tipo_publicacao-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_tipo_publicacao__RAND__.value, t: 'item', f: 'tipo_publicacao' },
					success: function(resp){
						$j('[name="tipo_publicacao"]').val(resp.results[0].id);
						$j('[id=tipo_publicacao-container-readonly__RAND__]').html('<span id="tipo_publicacao-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipo_publicacao_view_parent]').hide(); }else{ $j('.btn[id=tipo_publicacao_view_parent]').show(); }

						if(typeof(tipo_publicacao_update_autofills__RAND__) == 'function') tipo_publicacao_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_tipo_publicacao__RAND__.value, t: 'item', f: 'tipo_publicacao' },
				success: function(resp){
					$j('[id=tipo_publicacao-container__RAND__], [id=tipo_publicacao-container-readonly__RAND__]').html('<span id="tipo_publicacao-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipo_publicacao_view_parent]').hide(); }else{ $j('.btn[id=tipo_publicacao_view_parent]').show(); }

					if(typeof(tipo_publicacao_update_autofills__RAND__) == 'function') tipo_publicacao_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function colecao_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#colecao-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_colecao__RAND__.value, t: 'item', f: 'colecao' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="colecao"]').val(resp.results[0].id);
							$j('[id=colecao-container-readonly__RAND__]').html('<span id="colecao-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=colecao_view_parent]').hide(); }else{ $j('.btn[id=colecao_view_parent]').show(); }

						if(typeof(grupo_reload__RAND__) == 'function') grupo_reload__RAND__(AppGini.current_colecao__RAND__.value);

							if(typeof(colecao_update_autofills__RAND__) == 'function') colecao_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'colecao' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_colecao__RAND__.value = e.added.id;
				AppGini.current_colecao__RAND__.text = e.added.text;
				$j('[name="colecao"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=colecao_view_parent]').hide(); }else{ $j('.btn[id=colecao_view_parent]').show(); }

						if(typeof(grupo_reload__RAND__) == 'function') grupo_reload__RAND__(AppGini.current_colecao__RAND__.value);

				if(typeof(colecao_update_autofills__RAND__) == 'function') colecao_update_autofills__RAND__();
			});

			if(!$j("#colecao-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_colecao__RAND__.value, t: 'item', f: 'colecao' },
					success: function(resp){
						$j('[name="colecao"]').val(resp.results[0].id);
						$j('[id=colecao-container-readonly__RAND__]').html('<span id="colecao-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=colecao_view_parent]').hide(); }else{ $j('.btn[id=colecao_view_parent]').show(); }

						if(typeof(colecao_update_autofills__RAND__) == 'function') colecao_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_colecao__RAND__.value, t: 'item', f: 'colecao' },
				success: function(resp){
					$j('[id=colecao-container__RAND__], [id=colecao-container-readonly__RAND__]').html('<span id="colecao-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=colecao_view_parent]').hide(); }else{ $j('.btn[id=colecao_view_parent]').show(); }

					if(typeof(colecao_update_autofills__RAND__) == 'function') colecao_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function grupo_reload__RAND__(filterer_colecao){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#grupo-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { filterer_colecao: filterer_colecao, id: AppGini.current_grupo__RAND__.value, t: 'item', f: 'grupo' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="grupo"]').val(resp.results[0].id);
							$j('[id=grupo-container-readonly__RAND__]').html('<span id="grupo-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=grupo_view_parent]').hide(); }else{ $j('.btn[id=grupo_view_parent]').show(); }

						if(typeof(serie_reload__RAND__) == 'function') serie_reload__RAND__(AppGini.current_grupo__RAND__.value);
						if(typeof(serie_codigo_reload__RAND__) == 'function') serie_codigo_reload__RAND__(AppGini.current_grupo__RAND__.value);

							if(typeof(grupo_update_autofills__RAND__) == 'function') grupo_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { filterer_colecao: filterer_colecao, s: term, p: page, t: 'item', f: 'grupo' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_grupo__RAND__.value = e.added.id;
				AppGini.current_grupo__RAND__.text = e.added.text;
				$j('[name="grupo"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=grupo_view_parent]').hide(); }else{ $j('.btn[id=grupo_view_parent]').show(); }

						if(typeof(serie_reload__RAND__) == 'function') serie_reload__RAND__(AppGini.current_grupo__RAND__.value);
						if(typeof(serie_codigo_reload__RAND__) == 'function') serie_codigo_reload__RAND__(AppGini.current_grupo__RAND__.value);

				if(typeof(grupo_update_autofills__RAND__) == 'function') grupo_update_autofills__RAND__();
			});

			if(!$j("#grupo-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_grupo__RAND__.value, t: 'item', f: 'grupo' },
					success: function(resp){
						$j('[name="grupo"]').val(resp.results[0].id);
						$j('[id=grupo-container-readonly__RAND__]').html('<span id="grupo-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=grupo_view_parent]').hide(); }else{ $j('.btn[id=grupo_view_parent]').show(); }

						if(typeof(grupo_update_autofills__RAND__) == 'function') grupo_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_grupo__RAND__.value, t: 'item', f: 'grupo' },
				success: function(resp){
					$j('[id=grupo-container__RAND__], [id=grupo-container-readonly__RAND__]').html('<span id="grupo-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=grupo_view_parent]').hide(); }else{ $j('.btn[id=grupo_view_parent]').show(); }

					if(typeof(grupo_update_autofills__RAND__) == 'function') grupo_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function serie_reload__RAND__(filterer_grupo){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#serie-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { filterer_grupo: filterer_grupo, id: AppGini.current_serie__RAND__.value, t: 'item', f: 'serie' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="serie"]').val(resp.results[0].id);
							$j('[id=serie-container-readonly__RAND__]').html('<span id="serie-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=serie_view_parent]').hide(); }else{ $j('.btn[id=serie_view_parent]').show(); }

						if(typeof(subserie_reload__RAND__) == 'function') subserie_reload__RAND__(AppGini.current_serie__RAND__.value);

							if(typeof(serie_update_autofills__RAND__) == 'function') serie_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { filterer_grupo: filterer_grupo, s: term, p: page, t: 'item', f: 'serie' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_serie__RAND__.value = e.added.id;
				AppGini.current_serie__RAND__.text = e.added.text;
				$j('[name="serie"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=serie_view_parent]').hide(); }else{ $j('.btn[id=serie_view_parent]').show(); }

						if(typeof(subserie_reload__RAND__) == 'function') subserie_reload__RAND__(AppGini.current_serie__RAND__.value);

				if(typeof(serie_update_autofills__RAND__) == 'function') serie_update_autofills__RAND__();
			});

			if(!$j("#serie-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_serie__RAND__.value, t: 'item', f: 'serie' },
					success: function(resp){
						$j('[name="serie"]').val(resp.results[0].id);
						$j('[id=serie-container-readonly__RAND__]').html('<span id="serie-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=serie_view_parent]').hide(); }else{ $j('.btn[id=serie_view_parent]').show(); }

						if(typeof(serie_update_autofills__RAND__) == 'function') serie_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_serie__RAND__.value, t: 'item', f: 'serie' },
				success: function(resp){
					$j('[id=serie-container__RAND__], [id=serie-container-readonly__RAND__]').html('<span id="serie-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=serie_view_parent]').hide(); }else{ $j('.btn[id=serie_view_parent]').show(); }

					if(typeof(serie_update_autofills__RAND__) == 'function') serie_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function subserie_reload__RAND__(filterer_serie){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#subserie-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { filterer_serie: filterer_serie, id: AppGini.current_subserie__RAND__.value, t: 'item', f: 'subserie' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="subserie"]').val(resp.results[0].id);
							$j('[id=subserie-container-readonly__RAND__]').html('<span id="subserie-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=subserie_view_parent]').hide(); }else{ $j('.btn[id=subserie_view_parent]').show(); }


							if(typeof(subserie_update_autofills__RAND__) == 'function') subserie_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { filterer_serie: filterer_serie, s: term, p: page, t: 'item', f: 'subserie' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_subserie__RAND__.value = e.added.id;
				AppGini.current_subserie__RAND__.text = e.added.text;
				$j('[name="subserie"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=subserie_view_parent]').hide(); }else{ $j('.btn[id=subserie_view_parent]').show(); }


				if(typeof(subserie_update_autofills__RAND__) == 'function') subserie_update_autofills__RAND__();
			});

			if(!$j("#subserie-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_subserie__RAND__.value, t: 'item', f: 'subserie' },
					success: function(resp){
						$j('[name="subserie"]').val(resp.results[0].id);
						$j('[id=subserie-container-readonly__RAND__]').html('<span id="subserie-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=subserie_view_parent]').hide(); }else{ $j('.btn[id=subserie_view_parent]').show(); }

						if(typeof(subserie_update_autofills__RAND__) == 'function') subserie_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_subserie__RAND__.value, t: 'item', f: 'subserie' },
				success: function(resp){
					$j('[id=subserie-container__RAND__], [id=subserie-container-readonly__RAND__]').html('<span id="subserie-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=subserie_view_parent]').hide(); }else{ $j('.btn[id=subserie_view_parent]').show(); }

					if(typeof(subserie_update_autofills__RAND__) == 'function') subserie_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function tipologia_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#tipologia-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_tipologia__RAND__.value, t: 'item', f: 'tipologia' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="tipologia"]').val(resp.results[0].id);
							$j('[id=tipologia-container-readonly__RAND__]').html('<span id="tipologia-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipologia_view_parent]').hide(); }else{ $j('.btn[id=tipologia_view_parent]').show(); }


							if(typeof(tipologia_update_autofills__RAND__) == 'function') tipologia_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'tipologia' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_tipologia__RAND__.value = e.added.id;
				AppGini.current_tipologia__RAND__.text = e.added.text;
				$j('[name="tipologia"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipologia_view_parent]').hide(); }else{ $j('.btn[id=tipologia_view_parent]').show(); }


				if(typeof(tipologia_update_autofills__RAND__) == 'function') tipologia_update_autofills__RAND__();
			});

			if(!$j("#tipologia-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_tipologia__RAND__.value, t: 'item', f: 'tipologia' },
					success: function(resp){
						$j('[name="tipologia"]').val(resp.results[0].id);
						$j('[id=tipologia-container-readonly__RAND__]').html('<span id="tipologia-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipologia_view_parent]').hide(); }else{ $j('.btn[id=tipologia_view_parent]').show(); }

						if(typeof(tipologia_update_autofills__RAND__) == 'function') tipologia_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_tipologia__RAND__.value, t: 'item', f: 'tipologia' },
				success: function(resp){
					$j('[id=tipologia-container__RAND__], [id=tipologia-container-readonly__RAND__]').html('<span id="tipologia-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=tipologia_view_parent]').hide(); }else{ $j('.btn[id=tipologia_view_parent]').show(); }

					if(typeof(tipologia_update_autofills__RAND__) == 'function') tipologia_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function genero_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#genero-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_genero__RAND__.value, t: 'item', f: 'genero' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="genero"]').val(resp.results[0].id);
							$j('[id=genero-container-readonly__RAND__]').html('<span id="genero-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=genero_view_parent]').hide(); }else{ $j('.btn[id=genero_view_parent]').show(); }


							if(typeof(genero_update_autofills__RAND__) == 'function') genero_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'genero' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_genero__RAND__.value = e.added.id;
				AppGini.current_genero__RAND__.text = e.added.text;
				$j('[name="genero"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=genero_view_parent]').hide(); }else{ $j('.btn[id=genero_view_parent]').show(); }


				if(typeof(genero_update_autofills__RAND__) == 'function') genero_update_autofills__RAND__();
			});

			if(!$j("#genero-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_genero__RAND__.value, t: 'item', f: 'genero' },
					success: function(resp){
						$j('[name="genero"]').val(resp.results[0].id);
						$j('[id=genero-container-readonly__RAND__]').html('<span id="genero-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=genero_view_parent]').hide(); }else{ $j('.btn[id=genero_view_parent]').show(); }

						if(typeof(genero_update_autofills__RAND__) == 'function') genero_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_genero__RAND__.value, t: 'item', f: 'genero' },
				success: function(resp){
					$j('[id=genero-container__RAND__], [id=genero-container-readonly__RAND__]').html('<span id="genero-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=genero_view_parent]').hide(); }else{ $j('.btn[id=genero_view_parent]').show(); }

					if(typeof(genero_update_autofills__RAND__) == 'function') genero_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function formato_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#formato-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_formato__RAND__.value, t: 'item', f: 'formato' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="formato"]').val(resp.results[0].id);
							$j('[id=formato-container-readonly__RAND__]').html('<span id="formato-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=formato_view_parent]').hide(); }else{ $j('.btn[id=formato_view_parent]').show(); }


							if(typeof(formato_update_autofills__RAND__) == 'function') formato_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'formato' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_formato__RAND__.value = e.added.id;
				AppGini.current_formato__RAND__.text = e.added.text;
				$j('[name="formato"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=formato_view_parent]').hide(); }else{ $j('.btn[id=formato_view_parent]').show(); }


				if(typeof(formato_update_autofills__RAND__) == 'function') formato_update_autofills__RAND__();
			});

			if(!$j("#formato-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_formato__RAND__.value, t: 'item', f: 'formato' },
					success: function(resp){
						$j('[name="formato"]').val(resp.results[0].id);
						$j('[id=formato-container-readonly__RAND__]').html('<span id="formato-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=formato_view_parent]').hide(); }else{ $j('.btn[id=formato_view_parent]').show(); }

						if(typeof(formato_update_autofills__RAND__) == 'function') formato_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_formato__RAND__.value, t: 'item', f: 'formato' },
				success: function(resp){
					$j('[id=formato-container__RAND__], [id=formato-container-readonly__RAND__]').html('<span id="formato-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=formato_view_parent]').hide(); }else{ $j('.btn[id=formato_view_parent]').show(); }

					if(typeof(formato_update_autofills__RAND__) == 'function') formato_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function suporte_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#suporte-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_suporte__RAND__.value, t: 'item', f: 'suporte' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="suporte"]').val(resp.results[0].id);
							$j('[id=suporte-container-readonly__RAND__]').html('<span id="suporte-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=suporte_view_parent]').hide(); }else{ $j('.btn[id=suporte_view_parent]').show(); }


							if(typeof(suporte_update_autofills__RAND__) == 'function') suporte_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'suporte' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_suporte__RAND__.value = e.added.id;
				AppGini.current_suporte__RAND__.text = e.added.text;
				$j('[name="suporte"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=suporte_view_parent]').hide(); }else{ $j('.btn[id=suporte_view_parent]').show(); }


				if(typeof(suporte_update_autofills__RAND__) == 'function') suporte_update_autofills__RAND__();
			});

			if(!$j("#suporte-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_suporte__RAND__.value, t: 'item', f: 'suporte' },
					success: function(resp){
						$j('[name="suporte"]').val(resp.results[0].id);
						$j('[id=suporte-container-readonly__RAND__]').html('<span id="suporte-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=suporte_view_parent]').hide(); }else{ $j('.btn[id=suporte_view_parent]').show(); }

						if(typeof(suporte_update_autofills__RAND__) == 'function') suporte_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_suporte__RAND__.value, t: 'item', f: 'suporte' },
				success: function(resp){
					$j('[id=suporte-container__RAND__], [id=suporte-container-readonly__RAND__]').html('<span id="suporte-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=suporte_view_parent]').hide(); }else{ $j('.btn[id=suporte_view_parent]').show(); }

					if(typeof(suporte_update_autofills__RAND__) == 'function') suporte_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function documentos_relacionados_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#documentos_relacionados-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_documentos_relacionados__RAND__.value, t: 'item', f: 'documentos_relacionados' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="documentos_relacionados"]').val(resp.results[0].id);
							$j('[id=documentos_relacionados-container-readonly__RAND__]').html('<span id="documentos_relacionados-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=item_view_parent]').hide(); }else{ $j('.btn[id=item_view_parent]').show(); }


							if(typeof(documentos_relacionados_update_autofills__RAND__) == 'function') documentos_relacionados_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'documentos_relacionados' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_documentos_relacionados__RAND__.value = e.added.id;
				AppGini.current_documentos_relacionados__RAND__.text = e.added.text;
				$j('[name="documentos_relacionados"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=item_view_parent]').hide(); }else{ $j('.btn[id=item_view_parent]').show(); }


				if(typeof(documentos_relacionados_update_autofills__RAND__) == 'function') documentos_relacionados_update_autofills__RAND__();
			});

			if(!$j("#documentos_relacionados-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_documentos_relacionados__RAND__.value, t: 'item', f: 'documentos_relacionados' },
					success: function(resp){
						$j('[name="documentos_relacionados"]').val(resp.results[0].id);
						$j('[id=documentos_relacionados-container-readonly__RAND__]').html('<span id="documentos_relacionados-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=item_view_parent]').hide(); }else{ $j('.btn[id=item_view_parent]').show(); }

						if(typeof(documentos_relacionados_update_autofills__RAND__) == 'function') documentos_relacionados_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_documentos_relacionados__RAND__.value, t: 'item', f: 'documentos_relacionados' },
				success: function(resp){
					$j('[id=documentos_relacionados-container__RAND__], [id=documentos_relacionados-container-readonly__RAND__]').html('<span id="documentos_relacionados-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=item_view_parent]').hide(); }else{ $j('.btn[id=item_view_parent]').show(); }

					if(typeof(documentos_relacionados_update_autofills__RAND__) == 'function') documentos_relacionados_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function numero_caixa_reload__RAND__(){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#numero_caixa-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { id: AppGini.current_numero_caixa__RAND__.value, t: 'item', f: 'numero_caixa' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="numero_caixa"]').val(resp.results[0].id);
							$j('[id=numero_caixa-container-readonly__RAND__]').html('<span id="numero_caixa-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_caixa_view_parent]').hide(); }else{ $j('.btn[id=numero_caixa_view_parent]').show(); }

						if(typeof(nome_caixa_reload__RAND__) == 'function') nome_caixa_reload__RAND__(AppGini.current_numero_caixa__RAND__.value);

							if(typeof(numero_caixa_update_autofills__RAND__) == 'function') numero_caixa_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { s: term, p: page, t: 'item', f: 'numero_caixa' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_numero_caixa__RAND__.value = e.added.id;
				AppGini.current_numero_caixa__RAND__.text = e.added.text;
				$j('[name="numero_caixa"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_caixa_view_parent]').hide(); }else{ $j('.btn[id=numero_caixa_view_parent]').show(); }

						if(typeof(nome_caixa_reload__RAND__) == 'function') nome_caixa_reload__RAND__(AppGini.current_numero_caixa__RAND__.value);

				if(typeof(numero_caixa_update_autofills__RAND__) == 'function') numero_caixa_update_autofills__RAND__();
			});

			if(!$j("#numero_caixa-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_numero_caixa__RAND__.value, t: 'item', f: 'numero_caixa' },
					success: function(resp){
						$j('[name="numero_caixa"]').val(resp.results[0].id);
						$j('[id=numero_caixa-container-readonly__RAND__]').html('<span id="numero_caixa-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_caixa_view_parent]').hide(); }else{ $j('.btn[id=numero_caixa_view_parent]').show(); }

						if(typeof(numero_caixa_update_autofills__RAND__) == 'function') numero_caixa_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_numero_caixa__RAND__.value, t: 'item', f: 'numero_caixa' },
				success: function(resp){
					$j('[id=numero_caixa-container__RAND__], [id=numero_caixa-container-readonly__RAND__]').html('<span id="numero_caixa-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_caixa_view_parent]').hide(); }else{ $j('.btn[id=numero_caixa_view_parent]').show(); }

					if(typeof(numero_caixa_update_autofills__RAND__) == 'function') numero_caixa_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function nome_caixa_reload__RAND__(filterer_numero_caixa){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#nome_caixa-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { filterer_numero_caixa: filterer_numero_caixa, id: AppGini.current_nome_caixa__RAND__.value, t: 'item', f: 'nome_caixa' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="nome_caixa"]').val(resp.results[0].id);
							$j('[id=nome_caixa-container-readonly__RAND__]').html('<span id="nome_caixa-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_caixa_view_parent]').hide(); }else{ $j('.btn[id=nome_caixa_view_parent]').show(); }

						if(typeof(numero_pasta_reload__RAND__) == 'function') numero_pasta_reload__RAND__(AppGini.current_nome_caixa__RAND__.value);

							if(typeof(nome_caixa_update_autofills__RAND__) == 'function') nome_caixa_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { filterer_numero_caixa: filterer_numero_caixa, s: term, p: page, t: 'item', f: 'nome_caixa' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_nome_caixa__RAND__.value = e.added.id;
				AppGini.current_nome_caixa__RAND__.text = e.added.text;
				$j('[name="nome_caixa"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_caixa_view_parent]').hide(); }else{ $j('.btn[id=nome_caixa_view_parent]').show(); }

						if(typeof(numero_pasta_reload__RAND__) == 'function') numero_pasta_reload__RAND__(AppGini.current_nome_caixa__RAND__.value);

				if(typeof(nome_caixa_update_autofills__RAND__) == 'function') nome_caixa_update_autofills__RAND__();
			});

			if(!$j("#nome_caixa-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_nome_caixa__RAND__.value, t: 'item', f: 'nome_caixa' },
					success: function(resp){
						$j('[name="nome_caixa"]').val(resp.results[0].id);
						$j('[id=nome_caixa-container-readonly__RAND__]').html('<span id="nome_caixa-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_caixa_view_parent]').hide(); }else{ $j('.btn[id=nome_caixa_view_parent]').show(); }

						if(typeof(nome_caixa_update_autofills__RAND__) == 'function') nome_caixa_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_nome_caixa__RAND__.value, t: 'item', f: 'nome_caixa' },
				success: function(resp){
					$j('[id=nome_caixa-container__RAND__], [id=nome_caixa-container-readonly__RAND__]').html('<span id="nome_caixa-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_caixa_view_parent]').hide(); }else{ $j('.btn[id=nome_caixa_view_parent]').show(); }

					if(typeof(nome_caixa_update_autofills__RAND__) == 'function') nome_caixa_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function numero_pasta_reload__RAND__(filterer_nome_caixa){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#numero_pasta-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { filterer_nome_caixa: filterer_nome_caixa, id: AppGini.current_numero_pasta__RAND__.value, t: 'item', f: 'numero_pasta' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="numero_pasta"]').val(resp.results[0].id);
							$j('[id=numero_pasta-container-readonly__RAND__]').html('<span id="numero_pasta-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_pasta_view_parent]').hide(); }else{ $j('.btn[id=numero_pasta_view_parent]').show(); }

						if(typeof(nome_pasta_reload__RAND__) == 'function') nome_pasta_reload__RAND__(AppGini.current_numero_pasta__RAND__.value);

							if(typeof(numero_pasta_update_autofills__RAND__) == 'function') numero_pasta_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { filterer_nome_caixa: filterer_nome_caixa, s: term, p: page, t: 'item', f: 'numero_pasta' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_numero_pasta__RAND__.value = e.added.id;
				AppGini.current_numero_pasta__RAND__.text = e.added.text;
				$j('[name="numero_pasta"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_pasta_view_parent]').hide(); }else{ $j('.btn[id=numero_pasta_view_parent]').show(); }

						if(typeof(nome_pasta_reload__RAND__) == 'function') nome_pasta_reload__RAND__(AppGini.current_numero_pasta__RAND__.value);

				if(typeof(numero_pasta_update_autofills__RAND__) == 'function') numero_pasta_update_autofills__RAND__();
			});

			if(!$j("#numero_pasta-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_numero_pasta__RAND__.value, t: 'item', f: 'numero_pasta' },
					success: function(resp){
						$j('[name="numero_pasta"]').val(resp.results[0].id);
						$j('[id=numero_pasta-container-readonly__RAND__]').html('<span id="numero_pasta-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_pasta_view_parent]').hide(); }else{ $j('.btn[id=numero_pasta_view_parent]').show(); }

						if(typeof(numero_pasta_update_autofills__RAND__) == 'function') numero_pasta_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_numero_pasta__RAND__.value, t: 'item', f: 'numero_pasta' },
				success: function(resp){
					$j('[id=numero_pasta-container__RAND__], [id=numero_pasta-container-readonly__RAND__]').html('<span id="numero_pasta-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=numero_pasta_view_parent]').hide(); }else{ $j('.btn[id=numero_pasta_view_parent]').show(); }

					if(typeof(numero_pasta_update_autofills__RAND__) == 'function') numero_pasta_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
		function nome_pasta_reload__RAND__(filterer_numero_pasta){
		<?php if(($AllowUpdate || $AllowInsert) && !$dvprint){ ?>

			$j("#nome_pasta-container__RAND__").select2({
				/* initial default value */
				initSelection: function(e, c){
					$j.ajax({
						url: 'ajax_combo.php',
						dataType: 'json',
						data: { filterer_numero_pasta: filterer_numero_pasta, id: AppGini.current_nome_pasta__RAND__.value, t: 'item', f: 'nome_pasta' },
						success: function(resp){
							c({
								id: resp.results[0].id,
								text: resp.results[0].text
							});
							$j('[name="nome_pasta"]').val(resp.results[0].id);
							$j('[id=nome_pasta-container-readonly__RAND__]').html('<span id="nome_pasta-match-text">' + resp.results[0].text + '</span>');
							if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_pasta_view_parent]').hide(); }else{ $j('.btn[id=nome_pasta_view_parent]').show(); }


							if(typeof(nome_pasta_update_autofills__RAND__) == 'function') nome_pasta_update_autofills__RAND__();
						}
					});
				},
				width: '100%',
				formatNoMatches: function(term){ /* */ return '<?php echo addslashes($Translation['No matches found!']); ?>'; },
				minimumResultsForSearch: 5,
				loadMorePadding: 200,
				ajax: {
					url: 'ajax_combo.php',
					dataType: 'json',
					cache: true,
					data: function(term, page){ /* */ return { filterer_numero_pasta: filterer_numero_pasta, s: term, p: page, t: 'item', f: 'nome_pasta' }; },
					results: function(resp, page){ /* */ return resp; }
				},
				escapeMarkup: function(str){ /* */ return str; }
			}).on('change', function(e){
				AppGini.current_nome_pasta__RAND__.value = e.added.id;
				AppGini.current_nome_pasta__RAND__.text = e.added.text;
				$j('[name="nome_pasta"]').val(e.added.id);
				if(e.added.id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_pasta_view_parent]').hide(); }else{ $j('.btn[id=nome_pasta_view_parent]').show(); }


				if(typeof(nome_pasta_update_autofills__RAND__) == 'function') nome_pasta_update_autofills__RAND__();
			});

			if(!$j("#nome_pasta-container__RAND__").length){
				$j.ajax({
					url: 'ajax_combo.php',
					dataType: 'json',
					data: { id: AppGini.current_nome_pasta__RAND__.value, t: 'item', f: 'nome_pasta' },
					success: function(resp){
						$j('[name="nome_pasta"]').val(resp.results[0].id);
						$j('[id=nome_pasta-container-readonly__RAND__]').html('<span id="nome_pasta-match-text">' + resp.results[0].text + '</span>');
						if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_pasta_view_parent]').hide(); }else{ $j('.btn[id=nome_pasta_view_parent]').show(); }

						if(typeof(nome_pasta_update_autofills__RAND__) == 'function') nome_pasta_update_autofills__RAND__();
					}
				});
			}

		<?php }else{ ?>

			$j.ajax({
				url: 'ajax_combo.php',
				dataType: 'json',
				data: { id: AppGini.current_nome_pasta__RAND__.value, t: 'item', f: 'nome_pasta' },
				success: function(resp){
					$j('[id=nome_pasta-container__RAND__], [id=nome_pasta-container-readonly__RAND__]').html('<span id="nome_pasta-match-text">' + resp.results[0].text + '</span>');
					if(resp.results[0].id == '<?php echo empty_lookup_value; ?>'){ $j('.btn[id=nome_pasta_view_parent]').hide(); }else{ $j('.btn[id=nome_pasta_view_parent]').show(); }

					if(typeof(nome_pasta_update_autofills__RAND__) == 'function') nome_pasta_update_autofills__RAND__();
				}
			});
		<?php } ?>

		}
	</script>
	<?php

	$lookups = str_replace('__RAND__', $rnd1, ob_get_contents());
	ob_end_clean();


	// code for template based detail view forms

	// open the detail view template
	if($dvprint){
		$template_file = is_file("./{$TemplateDVP}") ? "./{$TemplateDVP}" : './templates/item_templateDVP.html';
		$templateCode = @file_get_contents($template_file);
	}else{
		$template_file = is_file("./{$TemplateDV}") ? "./{$TemplateDV}" : './templates/item_templateDV.html';
		$templateCode = @file_get_contents($template_file);
	}

	// process form title
	$templateCode = str_replace('<%%DETAIL_VIEW_TITLE%%>', 'Itens', $templateCode);
	$templateCode = str_replace('<%%RND1%%>', $rnd1, $templateCode);
	$templateCode = str_replace('<%%EMBEDDED%%>', ($_REQUEST['Embedded'] ? 'Embedded=1' : ''), $templateCode);
	// process buttons
	if($AllowInsert){
		if(!$selected_id) $templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-success" id="insert" name="insert_x" value="1" onclick="return item_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save New'] . '</button>', $templateCode);
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="insert" name="insert_x" value="1" onclick="return item_validateData();"><i class="glyphicon glyphicon-plus-sign"></i> ' . $Translation['Save As Copy'] . '</button>', $templateCode);
	}else{
		$templateCode = str_replace('<%%INSERT_BUTTON%%>', '', $templateCode);
	}

	// 'Back' button action
	if($_REQUEST['Embedded']){
		$backAction = 'AppGini.closeParentModal(); return false;';
	}else{
		$backAction = '$j(\'form\').eq(0).attr(\'novalidate\', \'novalidate\'); document.myform.reset(); return true;';
	}

	if($selected_id){
		if(!$_REQUEST['Embedded']) $templateCode = str_replace('<%%DVPRINT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="dvprint" name="dvprint_x" value="1" onclick="$j(\'form\').eq(0).prop(\'novalidate\', true); document.myform.reset(); return true;" title="' . html_attr($Translation['Print Preview']) . '"><i class="glyphicon glyphicon-print"></i> ' . $Translation['Print Preview'] . '</button>', $templateCode);
		if($AllowUpdate){
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '<button type="submit" class="btn btn-success btn-lg" id="update" name="update_x" value="1" onclick="return item_validateData();" title="' . html_attr($Translation['Save Changes']) . '"><i class="glyphicon glyphicon-ok"></i> ' . $Translation['Save Changes'] . '</button>', $templateCode);
		}else{
			$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		}
		if(($arrPerm[4]==1 && $ownerMemberID==getLoggedMemberID()) || ($arrPerm[4]==2 && $ownerGroupID==getLoggedGroupID()) || $arrPerm[4]==3){ // allow delete?
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '<button type="submit" class="btn btn-danger" id="delete" name="delete_x" value="1" onclick="return confirm(\'' . $Translation['are you sure?'] . '\');" title="' . html_attr($Translation['Delete']) . '"><i class="glyphicon glyphicon-trash"></i> ' . $Translation['Delete'] . '</button>', $templateCode);
		}else{
			$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		}
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>', $templateCode);
	}else{
		$templateCode = str_replace('<%%UPDATE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DELETE_BUTTON%%>', '', $templateCode);
		$templateCode = str_replace('<%%DESELECT_BUTTON%%>', ($ShowCancel ? '<button type="submit" class="btn btn-default" id="deselect" name="deselect_x" value="1" onclick="' . $backAction . '" title="' . html_attr($Translation['Back']) . '"><i class="glyphicon glyphicon-chevron-left"></i> ' . $Translation['Back'] . '</button>' : ''), $templateCode);
	}

	// set records to read only if user can't insert new records and can't edit current record
	if(($selected_id && !$AllowUpdate && !$AllowInsert) || (!$selected_id && !$AllowInsert)){
		$jsReadOnly .= "\tjQuery('#titulo').replaceWith('<div class=\"form-control-static\" id=\"titulo\">' + (jQuery('#titulo').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#titulo_atribuido').prop('disabled', true);\n";
		$jsReadOnly .= "\tjQuery('#descricao').replaceWith('<div class=\"form-control-static\" id=\"descricao\">' + (jQuery('#descricao').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#date').prop('readonly', true);\n";
		$jsReadOnly .= "\tjQuery('#dateDay, #dateMonth, #dateYear').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#data_livre').replaceWith('<div class=\"form-control-static\" id=\"data_livre\">' + (jQuery('#data_livre').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#data_atribuida').prop('disabled', true);\n";
		$jsReadOnly .= "\tjQuery('#autoria').replaceWith('<div class=\"form-control-static\" id=\"autoria\">' + (jQuery('#autoria').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#quantidade').replaceWith('<div class=\"form-control-static\" id=\"quantidade\">' + (jQuery('#quantidade').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#idioma').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#idioma_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#local_producao').replaceWith('<div class=\"form-control-static\" id=\"local_producao\">' + (jQuery('#local_producao').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#local_publicacao_veiculo').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#local_publicacao_veiculo_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#local_publicacao').replaceWith('<div class=\"form-control-static\" id=\"local_publicacao\">' + (jQuery('#local_publicacao').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#tipo_publicacao').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#tipo_publicacao_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#identificacao').replaceWith('<div class=\"form-control-static\" id=\"identificacao\">' + (jQuery('#identificacao').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#colecao').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#colecao_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#grupo').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#grupo_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#serie').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#serie_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#subserie').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#subserie_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#tipologia').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#tipologia_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#genero').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#genero_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#forma').replaceWith('<div class=\"form-control-static\" id=\"forma\">' + (jQuery('#forma').val() || '') + '</div>'); jQuery('#forma-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#s2id_forma').remove();\n";
		$jsReadOnly .= "\tjQuery('#formato').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#formato_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#escritura').replaceWith('<div class=\"form-control-static\" id=\"escritura\">' + (jQuery('#escritura').val() || '') + '</div>'); jQuery('#escritura-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#s2id_escritura').remove();\n";
		$jsReadOnly .= "\tjQuery('#suporte').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#suporte_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#dimensao').replaceWith('<div class=\"form-control-static\" id=\"dimensao\">' + (jQuery('#dimensao').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#estado_conservacao').replaceWith('<div class=\"form-control-static\" id=\"estado_conservacao\">' + (jQuery('#estado_conservacao').val() || '') + '</div>'); jQuery('#estado_conservacao-multi-selection-help').hide();\n";
		$jsReadOnly .= "\tjQuery('#s2id_estado_conservacao').remove();\n";
		$jsReadOnly .= "\tjQuery('#observacoes').replaceWith('<div class=\"form-control-static\" id=\"observacoes\">' + (jQuery('#observacoes').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#documentos_relacionados').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#documentos_relacionados_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#numero_caixa').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#numero_caixa_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#nome_caixa').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#nome_caixa_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#numero_pasta').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#numero_pasta_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#nome_pasta').prop('disabled', true).css({ color: '#555', backgroundColor: '#fff' });\n";
		$jsReadOnly .= "\tjQuery('#nome_pasta_caption').prop('disabled', true).css({ color: '#555', backgroundColor: 'white' });\n";
		$jsReadOnly .= "\tjQuery('#upload').replaceWith('<div class=\"form-control-static\" id=\"upload\">' + (jQuery('#upload').val() || '') + '</div>');\n";
		$jsReadOnly .= "\tjQuery('#upload, #upload-edit-link').hide();\n";
		$jsReadOnly .= "\tjQuery('#publicar').prop('disabled', true);\n";
		$jsReadOnly .= "\tjQuery('.select2-container').hide();\n";

		$noUploads = true;
	}elseif($AllowInsert){
		$jsEditable .= "\tjQuery('form').eq(0).data('already_changed', true);"; // temporarily disable form change handler
			$jsEditable .= "\tjQuery('form').eq(0).data('already_changed', false);"; // re-enable form change handler
	}

	// process combos
	$templateCode = str_replace('<%%COMBO(date)%%>', ($selected_id && !$arrPerm[3] ? '<div class="form-control-static">' . $combo_date->GetHTML(true) . '</div>' : $combo_date->GetHTML()), $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(date)%%>', $combo_date->GetHTML(true), $templateCode);
	$templateCode = str_replace('<%%COMBO(idioma)%%>', $combo_idioma->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(idioma)%%>', $combo_idioma->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(idioma)%%>', urlencode($combo_idioma->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(local_publicacao_veiculo)%%>', $combo_local_publicacao_veiculo->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(local_publicacao_veiculo)%%>', $combo_local_publicacao_veiculo->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(local_publicacao_veiculo)%%>', urlencode($combo_local_publicacao_veiculo->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(tipo_publicacao)%%>', $combo_tipo_publicacao->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(tipo_publicacao)%%>', $combo_tipo_publicacao->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(tipo_publicacao)%%>', urlencode($combo_tipo_publicacao->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(colecao)%%>', $combo_colecao->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(colecao)%%>', $combo_colecao->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(colecao)%%>', urlencode($combo_colecao->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(grupo)%%>', $combo_grupo->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(grupo)%%>', $combo_grupo->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(grupo)%%>', urlencode($combo_grupo->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(serie)%%>', $combo_serie->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(serie)%%>', $combo_serie->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(serie)%%>', urlencode($combo_serie->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(subserie)%%>', $combo_subserie->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(subserie)%%>', $combo_subserie->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(subserie)%%>', urlencode($combo_subserie->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(tipologia)%%>', $combo_tipologia->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(tipologia)%%>', $combo_tipologia->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(tipologia)%%>', urlencode($combo_tipologia->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(genero)%%>', $combo_genero->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(genero)%%>', $combo_genero->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(genero)%%>', urlencode($combo_genero->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(forma)%%>', $combo_forma->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(forma)%%>', $combo_forma->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(formato)%%>', $combo_formato->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(formato)%%>', $combo_formato->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(formato)%%>', urlencode($combo_formato->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(escritura)%%>', $combo_escritura->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(escritura)%%>', $combo_escritura->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(suporte)%%>', $combo_suporte->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(suporte)%%>', $combo_suporte->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(suporte)%%>', urlencode($combo_suporte->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(estado_conservacao)%%>', $combo_estado_conservacao->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(estado_conservacao)%%>', $combo_estado_conservacao->SelectedData, $templateCode);
	$templateCode = str_replace('<%%COMBO(documentos_relacionados)%%>', $combo_documentos_relacionados->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(documentos_relacionados)%%>', $combo_documentos_relacionados->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(documentos_relacionados)%%>', urlencode($combo_documentos_relacionados->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(numero_caixa)%%>', $combo_numero_caixa->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(numero_caixa)%%>', $combo_numero_caixa->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(numero_caixa)%%>', urlencode($combo_numero_caixa->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(nome_caixa)%%>', $combo_nome_caixa->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(nome_caixa)%%>', $combo_nome_caixa->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(nome_caixa)%%>', urlencode($combo_nome_caixa->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(numero_pasta)%%>', $combo_numero_pasta->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(numero_pasta)%%>', $combo_numero_pasta->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(numero_pasta)%%>', urlencode($combo_numero_pasta->MatchText), $templateCode);
	$templateCode = str_replace('<%%COMBO(nome_pasta)%%>', $combo_nome_pasta->HTML, $templateCode);
	$templateCode = str_replace('<%%COMBOTEXT(nome_pasta)%%>', $combo_nome_pasta->MatchText, $templateCode);
	$templateCode = str_replace('<%%URLCOMBOTEXT(nome_pasta)%%>', urlencode($combo_nome_pasta->MatchText), $templateCode);

	/* lookup fields array: 'lookup field name' => array('parent table name', 'lookup field caption') */
	$lookup_fields = array(  'idioma' => array('idioma', 'Idioma:'), 'local_publicacao_veiculo' => array('local_comunicacao', 'Ve&#237;culo de Publica&#231;&#227;o:'), 'tipo_publicacao' => array('tipo_publicacao', 'Tipo de Publica&#231;&#227;o:'), 'colecao' => array('colecao', 'Cole&#231;&#227;o:'), 'grupo' => array('grupo', 'Grupo:'), 'serie' => array('serie', 'S&#233;rie:'), 'subserie' => array('subserie', 'Subs&#233;rie:'), 'tipologia' => array('tipologia', 'Tipologia / Esp&#233;cie:'), 'genero' => array('genero', 'G&#234;nero:'), 'formato' => array('formato', 'Formato:'), 'suporte' => array('suporte', 'Suporte:'), 'documentos_relacionados' => array('item', 'Documentos Relacionados:'), 'numero_caixa' => array('numero_caixa', 'N&#250;mero da Caixa:'), 'nome_caixa' => array('nome_caixa', 'Nome da Caixa:'), 'numero_pasta' => array('numero_pasta', 'N&#250;mero da Pasta:'), 'nome_pasta' => array('nome_pasta', 'Nome da pasta:'));
	foreach($lookup_fields as $luf => $ptfc){
		$pt_perm = getTablePermissions($ptfc[0]);

		// process foreign key links
		if($pt_perm['view'] || $pt_perm['edit']){
			$templateCode = str_replace("<%%PLINK({$luf})%%>", '<button type="button" class="btn btn-default view_parent hspacer-md" id="' . $ptfc[0] . '_view_parent" title="' . html_attr($Translation['View'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-eye-open"></i></button>', $templateCode);
		}

		// if user has insert permission to parent table of a lookup field, put an add new button
		if($pt_perm['insert'] && !$_REQUEST['Embedded']){
			$templateCode = str_replace("<%%ADDNEW({$ptfc[0]})%%>", '<button type="button" class="btn btn-success add_new_parent hspacer-md" id="' . $ptfc[0] . '_add_new" title="' . html_attr($Translation['Add New'] . ' ' . $ptfc[1]) . '"><i class="glyphicon glyphicon-plus-sign"></i></button>', $templateCode);
		}
	}

	// process images
	$templateCode = str_replace('<%%UPLOADFILE(id)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(titulo)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(titulo_atribuido)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(descricao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(date)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(data_livre)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(data_atribuida)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(autoria)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(quantidade)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(idioma)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(local_producao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(local_publicacao_veiculo)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(local_publicacao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(tipo_publicacao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(identificacao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(colecao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(grupo)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(serie)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(subserie)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(numero_serie)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(tipologia)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(genero)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(forma)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(formato)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(escritura)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(suporte)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(dimensao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(estado_conservacao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(observacoes)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(documentos_relacionados)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(numero_caixa)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(nome_caixa)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(numero_pasta)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(nome_pasta)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(upload)%%>', ($noUploads ? '' : '<input type=hidden name=MAX_FILE_SIZE value=20480000>'.$Translation['upload image'].' <input type="file" name="upload" id="upload">'), $templateCode);
	if($AllowUpdate && $row['upload'] != ''){
		$templateCode = str_replace('<%%REMOVEFILE(upload)%%>', '<br><input type="checkbox" name="upload_remove" id="upload_remove" value="1"> <label for="upload_remove" style="color: red; font-weight: bold;">'.$Translation['remove image'].'</label>', $templateCode);
	}else{
		$templateCode = str_replace('<%%REMOVEFILE(upload)%%>', '', $templateCode);
	}
	$templateCode = str_replace('<%%UPLOADFILE(usuario_cadastro)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(usuario_alteracao)%%>', '', $templateCode);
	$templateCode = str_replace('<%%UPLOADFILE(publicar)%%>', '', $templateCode);

	// process values
	if($selected_id){
		if( $dvprint) $templateCode = str_replace('<%%VALUE(id)%%>', safe_html($urow['id']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(id)%%>', html_attr($row['id']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(id)%%>', urlencode($urow['id']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(titulo)%%>', safe_html($urow['titulo']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(titulo)%%>', html_attr($row['titulo']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(titulo)%%>', urlencode($urow['titulo']), $templateCode);
		$templateCode = str_replace('<%%CHECKED(titulo_atribuido)%%>', ($row['titulo_atribuido'] ? "checked" : ""), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)){
			$templateCode = str_replace('<%%VALUE(descricao)%%>', safe_html($urow['descricao']), $templateCode);
		}else{
			$templateCode = str_replace('<%%VALUE(descricao)%%>', html_attr($row['descricao']), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(descricao)%%>', urlencode($urow['descricao']), $templateCode);
		$templateCode = str_replace('<%%VALUE(date)%%>', @date('d/m/Y', @strtotime(html_attr($row['date']))), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(date)%%>', urlencode(@date('d/m/Y', @strtotime(html_attr($urow['date'])))), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(data_livre)%%>', safe_html($urow['data_livre']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(data_livre)%%>', html_attr($row['data_livre']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(data_livre)%%>', urlencode($urow['data_livre']), $templateCode);
		$templateCode = str_replace('<%%CHECKED(data_atribuida)%%>', ($row['data_atribuida'] ? "checked" : ""), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(autoria)%%>', safe_html($urow['autoria']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(autoria)%%>', html_attr($row['autoria']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(autoria)%%>', urlencode($urow['autoria']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(quantidade)%%>', safe_html($urow['quantidade']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(quantidade)%%>', html_attr($row['quantidade']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(quantidade)%%>', urlencode($urow['quantidade']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(idioma)%%>', safe_html($urow['idioma']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(idioma)%%>', html_attr($row['idioma']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(idioma)%%>', urlencode($urow['idioma']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(local_producao)%%>', safe_html($urow['local_producao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(local_producao)%%>', html_attr($row['local_producao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(local_producao)%%>', urlencode($urow['local_producao']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(local_publicacao_veiculo)%%>', safe_html($urow['local_publicacao_veiculo']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(local_publicacao_veiculo)%%>', html_attr($row['local_publicacao_veiculo']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(local_publicacao_veiculo)%%>', urlencode($urow['local_publicacao_veiculo']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(local_publicacao)%%>', safe_html($urow['local_publicacao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(local_publicacao)%%>', html_attr($row['local_publicacao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(local_publicacao)%%>', urlencode($urow['local_publicacao']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(tipo_publicacao)%%>', safe_html($urow['tipo_publicacao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(tipo_publicacao)%%>', html_attr($row['tipo_publicacao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tipo_publicacao)%%>', urlencode($urow['tipo_publicacao']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(identificacao)%%>', safe_html($urow['identificacao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(identificacao)%%>', html_attr($row['identificacao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(identificacao)%%>', urlencode($urow['identificacao']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(colecao)%%>', safe_html($urow['colecao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(colecao)%%>', html_attr($row['colecao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(colecao)%%>', urlencode($urow['colecao']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(grupo)%%>', safe_html($urow['grupo']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(grupo)%%>', html_attr($row['grupo']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(grupo)%%>', urlencode($urow['grupo']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(serie)%%>', safe_html($urow['serie']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(serie)%%>', html_attr($row['serie']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(serie)%%>', urlencode($urow['serie']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(subserie)%%>', safe_html($urow['subserie']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(subserie)%%>', html_attr($row['subserie']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(subserie)%%>', urlencode($urow['subserie']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(numero_serie)%%>', safe_html($urow['numero_serie']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(numero_serie)%%>', html_attr($row['numero_serie']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(numero_serie)%%>', urlencode($urow['numero_serie']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(tipologia)%%>', safe_html($urow['tipologia']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(tipologia)%%>', html_attr($row['tipologia']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tipologia)%%>', urlencode($urow['tipologia']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(genero)%%>', safe_html($urow['genero']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(genero)%%>', html_attr($row['genero']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(genero)%%>', urlencode($urow['genero']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(forma)%%>', safe_html($urow['forma']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(forma)%%>', html_attr($row['forma']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(forma)%%>', urlencode($urow['forma']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(formato)%%>', safe_html($urow['formato']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(formato)%%>', html_attr($row['formato']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(formato)%%>', urlencode($urow['formato']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(escritura)%%>', safe_html($urow['escritura']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(escritura)%%>', html_attr($row['escritura']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(escritura)%%>', urlencode($urow['escritura']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(suporte)%%>', safe_html($urow['suporte']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(suporte)%%>', html_attr($row['suporte']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(suporte)%%>', urlencode($urow['suporte']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(dimensao)%%>', safe_html($urow['dimensao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(dimensao)%%>', html_attr($row['dimensao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(dimensao)%%>', urlencode($urow['dimensao']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(estado_conservacao)%%>', safe_html($urow['estado_conservacao']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(estado_conservacao)%%>', html_attr($row['estado_conservacao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(estado_conservacao)%%>', urlencode($urow['estado_conservacao']), $templateCode);
		if($dvprint || (!$AllowUpdate && !$AllowInsert)){
			$templateCode = str_replace('<%%VALUE(observacoes)%%>', safe_html($urow['observacoes']), $templateCode);
		}else{
			$templateCode = str_replace('<%%VALUE(observacoes)%%>', html_attr($row['observacoes']), $templateCode);
		}
		$templateCode = str_replace('<%%URLVALUE(observacoes)%%>', urlencode($urow['observacoes']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(documentos_relacionados)%%>', safe_html($urow['documentos_relacionados']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(documentos_relacionados)%%>', html_attr($row['documentos_relacionados']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(documentos_relacionados)%%>', urlencode($urow['documentos_relacionados']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(numero_caixa)%%>', safe_html($urow['numero_caixa']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(numero_caixa)%%>', html_attr($row['numero_caixa']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(numero_caixa)%%>', urlencode($urow['numero_caixa']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(nome_caixa)%%>', safe_html($urow['nome_caixa']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(nome_caixa)%%>', html_attr($row['nome_caixa']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(nome_caixa)%%>', urlencode($urow['nome_caixa']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(numero_pasta)%%>', safe_html($urow['numero_pasta']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(numero_pasta)%%>', html_attr($row['numero_pasta']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(numero_pasta)%%>', urlencode($urow['numero_pasta']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(nome_pasta)%%>', safe_html($urow['nome_pasta']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(nome_pasta)%%>', html_attr($row['nome_pasta']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(nome_pasta)%%>', urlencode($urow['nome_pasta']), $templateCode);
		if( $dvprint) $templateCode = str_replace('<%%VALUE(upload)%%>', safe_html($urow['upload']), $templateCode);
		if(!$dvprint) $templateCode = str_replace('<%%VALUE(upload)%%>', html_attr($row['upload']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(upload)%%>', urlencode($urow['upload']), $templateCode);
		$templateCode = str_replace('<%%VALUE(usuario_cadastro)%%>', safe_html($urow['usuario_cadastro']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(usuario_cadastro)%%>', urlencode($urow['usuario_cadastro']), $templateCode);
		$templateCode = str_replace('<%%VALUE(usuario_alteracao)%%>', safe_html($urow['usuario_alteracao']), $templateCode);
		$templateCode = str_replace('<%%URLVALUE(usuario_alteracao)%%>', urlencode($urow['usuario_alteracao']), $templateCode);
		$templateCode = str_replace('<%%CHECKED(publicar)%%>', ($row['publicar'] ? "checked" : ""), $templateCode);
	}else{
		$templateCode = str_replace('<%%VALUE(id)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(id)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(titulo)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(titulo)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%CHECKED(titulo_atribuido)%%>', '', $templateCode);
		$templateCode = str_replace('<%%VALUE(descricao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(descricao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(date)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(date)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(data_livre)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(data_livre)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%CHECKED(data_atribuida)%%>', '', $templateCode);
		$templateCode = str_replace('<%%VALUE(autoria)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(autoria)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(quantidade)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(quantidade)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(idioma)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(idioma)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(local_producao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(local_producao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(local_publicacao_veiculo)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(local_publicacao_veiculo)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(local_publicacao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(local_publicacao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(tipo_publicacao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tipo_publicacao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(identificacao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(identificacao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(colecao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(colecao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(grupo)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(grupo)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(serie)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(serie)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(subserie)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(subserie)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(numero_serie)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(numero_serie)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(tipologia)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(tipologia)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(genero)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(genero)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(forma)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(forma)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(formato)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(formato)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(escritura)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(escritura)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(suporte)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(suporte)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(dimensao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(dimensao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(estado_conservacao)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(estado_conservacao)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(observacoes)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(observacoes)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(documentos_relacionados)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(documentos_relacionados)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(numero_caixa)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(numero_caixa)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(nome_caixa)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(nome_caixa)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(numero_pasta)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(numero_pasta)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(nome_pasta)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(nome_pasta)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(upload)%%>', '', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(upload)%%>', urlencode(''), $templateCode);
		$templateCode = str_replace('<%%VALUE(usuario_cadastro)%%>', '<%%creatorUsername%%>-<%%creationDateTime%%>', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(usuario_cadastro)%%>', urlencode('<%%creatorUsername%%>-<%%creationDateTime%%>'), $templateCode);
		$templateCode = str_replace('<%%VALUE(usuario_alteracao)%%>', '<%%editorUsername%%>-<%%editingDateTime%%>', $templateCode);
		$templateCode = str_replace('<%%URLVALUE(usuario_alteracao)%%>', urlencode('<%%editorUsername%%>-<%%editingDateTime%%>'), $templateCode);
		$templateCode = str_replace('<%%CHECKED(publicar)%%>', '', $templateCode);
	}

	// process translations
	foreach($Translation as $symbol=>$trans){
		$templateCode = str_replace("<%%TRANSLATION($symbol)%%>", $trans, $templateCode);
	}

	// clear scrap
	$templateCode = str_replace('<%%', '<!-- ', $templateCode);
	$templateCode = str_replace('%%>', ' -->', $templateCode);

	// hide links to inaccessible tables
	if($_REQUEST['dvprint_x'] == ''){
		$templateCode .= "\n\n<script>\$j(function(){\n";
		$arrTables = getTableList();
		foreach($arrTables as $name => $caption){
			$templateCode .= "\t\$j('#{$name}_link').removeClass('hidden');\n";
			$templateCode .= "\t\$j('#xs_{$name}_link').removeClass('hidden');\n";
		}

		$templateCode .= $jsReadOnly;
		$templateCode .= $jsEditable;

		if(!$selected_id){
			$templateCode.="\n\tif(document.getElementById('uploadEdit')){ document.getElementById('uploadEdit').style.display='inline'; }";
			$templateCode.="\n\tif(document.getElementById('uploadEditLink')){ document.getElementById('uploadEditLink').style.display='none'; }";
		}

		$templateCode.="\n});</script>\n";
	}

	// ajaxed auto-fill fields
	$templateCode .= '<script>';
	$templateCode .= '$j(function() {';

	$templateCode .= "\tcolecao_update_autofills$rnd1 = function(){\n";
	$templateCode .= "\t\t\$j.ajax({\n";
	if($dvprint){
		$templateCode .= "\t\t\turl: 'item_autofill.php?rnd1=$rnd1&mfk=colecao&id=' + encodeURIComponent('".addslashes($row['colecao'])."'),\n";
		$templateCode .= "\t\t\tcontentType: 'application/x-www-form-urlencoded; charset=" . datalist_db_encoding . "', type: 'GET'\n";
	}else{
		$templateCode .= "\t\t\turl: 'item_autofill.php?rnd1=$rnd1&mfk=colecao&id=' + encodeURIComponent(AppGini.current_colecao{$rnd1}.value),\n";
		$templateCode .= "\t\t\tcontentType: 'application/x-www-form-urlencoded; charset=" . datalist_db_encoding . "', type: 'GET', beforeSend: function(){ /* */ \$j('#colecao$rnd1').prop('disabled', true); \$j('#colecaoLoading').html('<img src=loading.gif align=top>'); }, complete: function(){".(($arrPerm[1] || (($arrPerm[3] == 1 && $ownerMemberID == getLoggedMemberID()) || ($arrPerm[3] == 2 && $ownerGroupID == getLoggedGroupID()) || $arrPerm[3] == 3)) ? "\$j('#colecao$rnd1').prop('disabled', false); " : "\$j('#colecao$rnd1').prop('disabled', true); ")."\$j('#colecaoLoading').html('');}\n";
	}
	$templateCode.="\t\t});\n";
	$templateCode.="\t};\n";
	if(!$dvprint) $templateCode.="\tif(\$j('#colecao_caption').length) \$j('#colecao_caption').click(function(){ /* */ colecao_update_autofills$rnd1(); });\n";

	$templateCode .= "\tgrupo_update_autofills$rnd1 = function(){\n";
	$templateCode .= "\t\t\$j.ajax({\n";
	if($dvprint){
		$templateCode .= "\t\t\turl: 'item_autofill.php?rnd1=$rnd1&mfk=grupo&id=' + encodeURIComponent('".addslashes($row['grupo'])."'),\n";
		$templateCode .= "\t\t\tcontentType: 'application/x-www-form-urlencoded; charset=" . datalist_db_encoding . "', type: 'GET'\n";
	}else{
		$templateCode .= "\t\t\turl: 'item_autofill.php?rnd1=$rnd1&mfk=grupo&id=' + encodeURIComponent(AppGini.current_grupo{$rnd1}.value),\n";
		$templateCode .= "\t\t\tcontentType: 'application/x-www-form-urlencoded; charset=" . datalist_db_encoding . "', type: 'GET', beforeSend: function(){ /* */ \$j('#grupo$rnd1').prop('disabled', true); \$j('#grupoLoading').html('<img src=loading.gif align=top>'); }, complete: function(){".(($arrPerm[1] || (($arrPerm[3] == 1 && $ownerMemberID == getLoggedMemberID()) || ($arrPerm[3] == 2 && $ownerGroupID == getLoggedGroupID()) || $arrPerm[3] == 3)) ? "\$j('#grupo$rnd1').prop('disabled', false); " : "\$j('#grupo$rnd1').prop('disabled', true); ")."\$j('#grupoLoading').html('');}\n";
	}
	$templateCode.="\t\t});\n";
	$templateCode.="\t};\n";
	if(!$dvprint) $templateCode.="\tif(\$j('#grupo_caption').length) \$j('#grupo_caption').click(function(){ /* */ grupo_update_autofills$rnd1(); });\n";

	$templateCode .= "\tserie_update_autofills$rnd1 = function(){\n";
	$templateCode .= "\t\t\$j.ajax({\n";
	if($dvprint){
		$templateCode .= "\t\t\turl: 'item_autofill.php?rnd1=$rnd1&mfk=serie&id=' + encodeURIComponent('".addslashes($row['serie'])."'),\n";
		$templateCode .= "\t\t\tcontentType: 'application/x-www-form-urlencoded; charset=" . datalist_db_encoding . "', type: 'GET'\n";
	}else{
		$templateCode .= "\t\t\turl: 'item_autofill.php?rnd1=$rnd1&mfk=serie&id=' + encodeURIComponent(AppGini.current_serie{$rnd1}.value),\n";
		$templateCode .= "\t\t\tcontentType: 'application/x-www-form-urlencoded; charset=" . datalist_db_encoding . "', type: 'GET', beforeSend: function(){ /* */ \$j('#serie$rnd1').prop('disabled', true); \$j('#serieLoading').html('<img src=loading.gif align=top>'); }, complete: function(){".(($arrPerm[1] || (($arrPerm[3] == 1 && $ownerMemberID == getLoggedMemberID()) || ($arrPerm[3] == 2 && $ownerGroupID == getLoggedGroupID()) || $arrPerm[3] == 3)) ? "\$j('#serie$rnd1').prop('disabled', false); " : "\$j('#serie$rnd1').prop('disabled', true); ")."\$j('#serieLoading').html('');}\n";
	}
	$templateCode.="\t\t});\n";
	$templateCode.="\t};\n";
	if(!$dvprint) $templateCode.="\tif(\$j('#serie_caption').length) \$j('#serie_caption').click(function(){ /* */ serie_update_autofills$rnd1(); });\n";


	$templateCode.="});";
	$templateCode.="</script>";
	$templateCode .= $lookups;

	// handle enforced parent values for read-only lookup fields

	// don't include blank images in lightbox gallery
	$templateCode = preg_replace('/blank.gif" data-lightbox=".*?"/', 'blank.gif"', $templateCode);

	// don't display empty email links
	$templateCode=preg_replace('/<a .*?href="mailto:".*?<\/a>/', '', $templateCode);

	/* default field values */
	$rdata = $jdata = get_defaults('item');
	if($selected_id){
		$jdata = get_joined_record('item', $selected_id);
		if($jdata === false) $jdata = get_defaults('item');
		$rdata = $row;
	}
	$templateCode .= loadView('item-ajax-cache', array('rdata' => $rdata, 'jdata' => $jdata));

	// hook: item_dv
	if(function_exists('item_dv')){
		$args=array();
		item_dv(($selected_id ? $selected_id : FALSE), getMemberInfo(), $templateCode, $args);
	}

	return $templateCode;
}
?>